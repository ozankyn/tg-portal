{% extends "base.html" %}

{% block title %}Email Şablonu Düzenle - İK Yönetim Sistemi{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-12">
        <h2><i class="bi bi-file-text"></i> Email Şablonu Düzenle</h2>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('email_ayarlari') }}">Email Ayarları</a></li>
                <li class="breadcrumb-item active">{{ sablon.sablon_adi }}</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="bi bi-pencil-square"></i> Şablon Düzenle: {{ sablon.sablon_adi }}</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label class="form-label">Şablon Adı</label>
                        <input type="text" class="form-control" value="{{ sablon.sablon_adi }}" disabled>
                        <small class="text-muted">Şablon adı değiştirilemez</small>
                    </div>

                    <div class="mb-3">
                        <label for="sablon_konusu" class="form-label">Email Konusu *</label>
                        <input type="text" class="form-control" id="sablon_konusu" 
                               name="sablon_konusu" value="{{ sablon.sablon_konusu }}" required>
                        <small class="text-muted">
                            Değişkenler: {ad_soyad}, {proje_adi}, {pozisyon_adi}, vb.
                        </small>
                    </div>

                    <div class="mb-3">
                        <label for="sablon_icerik" class="form-label">Email İçeriği (HTML) *</label>
                        <textarea class="form-control" id="sablon_icerik" name="sablon_icerik" 
                                  rows="20" required style="font-family: monospace; font-size: 12px;">{{ sablon.sablon_icerik }}</textarea>
                        <small class="text-muted">HTML formatında email içeriği</small>
                    </div>

                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="aktif" name="aktif" 
                                   {% if sablon.aktif %}checked{% endif %}>
                            <label class="form-check-label" for="aktif">
                                Şablon Aktif
                            </label>
                        </div>
                        <small class="text-muted">Pasif şablonlar email gönderiminde kullanılmaz</small>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Güncelle
                        </button>
                        <a href="{{ url_for('email_ayarlari') }}" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> İptal
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <!-- Kullanılabilir Değişkenler -->
        <div class="card mb-3">
            <div class="card-header bg-warning text-dark">
                <h6 class="mb-0"><i class="bi bi-code-square"></i> Kullanılabilir Değişkenler</h6>
            </div>
            <div class="card-body">
                <p><strong>Personel Bilgileri:</strong></p>
                <ul class="list-unstyled">
                    <li><code>{ad_soyad}</code></li>
                    <li><code>{telefon}</code></li>
                    <li><code>{email}</code></li>
                    <li><code>{ise_baslama_tarihi}</code></li>
                </ul>

                <p><strong>Pozisyon Bilgileri:</strong></p>
                <ul class="list-unstyled">
                    <li><code>{proje_adi}</code></li>
                    <li><code>{pozisyon_adi}</code></li>
                    <li><code>{il}</code></li>
                    <li><code>{ilce}</code></li>
                    <li><code>{magaza_adi}</code></li>
                </ul>

                <p><strong>Sistem Bilgileri:</strong></p>
                <ul class="list-unstyled">
                    <li><code>{portal_url}</code></li>
                    <li><code>{gonderim_zamani}</code></li>
                </ul>
            </div>
        </div>

        <!-- HTML Örnek Yapı -->
        <div class="card">
            <div class="card-header bg-success text-white">
                <h6 class="mb-0"><i class="bi bi-info-circle"></i> HTML İpuçları</h6>
            </div>
            <div class="card-body">
                <p><strong>Temel Yapı:</strong></p>
                <pre style="font-size: 11px; background: #f8f9fa; padding: 10px; border-radius: 5px;"><code>&lt;h2&gt;Başlık&lt;/h2&gt;
&lt;p&gt;Paragraf&lt;/p&gt;
&lt;strong&gt;Kalın&lt;/strong&gt;
&lt;a href="url"&gt;Link&lt;/a&gt;
&lt;hr&gt; (Çizgi)</code></pre>

                <p class="mt-3"><strong>Tablo Örneği:</strong></p>
                <pre style="font-size: 10px; background: #f8f9fa; padding: 10px; border-radius: 5px;"><code>&lt;table style="width:100%"&gt;
  &lt;tr&gt;
    &lt;td&gt;Başlık&lt;/td&gt;
    &lt;td&gt;Değer&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;</code></pre>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Textarea auto-resize
const textarea = document.getElementById('sablon_icerik');
textarea.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
});

// Sayfa yüklendiğinde boyutu ayarla
window.addEventListener('load', function() {
    textarea.style.height = (textarea.scrollHeight) + 'px';
});
</script>
{% endblock %}