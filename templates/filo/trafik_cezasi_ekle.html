{% extends "base.html" %}

{% block title %}Yeni Trafik Cezası Ekle{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-12">
            <h2><i class="bi bi-exclamation-triangle text-danger"></i> Yeni Trafik Cezası Ekle</h2>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('filo_trafik_cezalari') }}">Trafik Cezaları</a></li>
                    <li class="breadcrumb-item active">Yeni Ceza</li>
                </ol>
            </nav>
        </div>
    </div>

    <form method="POST" enctype="multipart/form-data">
        <div class="card mb-4">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">Araç ve Çalışan Bilgileri</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label">Araç <span class="text-danger">*</span></label>
                        <select name="arac_id" class="form-select" required>
                            <option value="">Seçiniz</option>
                            {% for arac in araclar %}
                            <option value="{{ arac.id }}">{{ arac.plaka }} - {{ arac.marka }} {{ arac.model }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Çalışan (Araç Kullanan)</label>
                        <select name="calisan_id" class="form-select">
                            <option value="">Seçiniz</option>
                            {% for calisan in calisanlar %}
                            <option value="{{ calisan.id }}">{{ calisan.ad_soyad }}</option>
                            {% endfor %}
                        </select>
                        <small class="text-muted">Ceza anında aracı kullanan kişi</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Ceza Bilgileri</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">Ceza Tarihi <span class="text-danger">*</span></label>
                        <input type="date" name="ceza_tarihi" class="form-control" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Ceza Saati</label>
                        <input type="time" name="ceza_saati" class="form-control">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Tebliğ Tarihi</label>
                        <input type="date" name="teblig_tarihi" class="form-control">
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <label class="form-label">Ceza Türü <span class="text-danger">*</span></label>
                        <select name="ceza_turu" id="ceza_turu_select" class="form-select" required>
                            <option value="">Seçiniz</option>
                            {% for tur in ceza_turleri %}
                            <option value="{{ tur.ceza_turu }}" data-tutar="{{ tur.varsayilan_tutar }}">
                                {{ tur.ceza_turu }}
                                {% if tur.varsayilan_tutar %}
                                ({{ "{:,.0f}".format(tur.varsayilan_tutar) }} TRY)
                                {% endif %}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Ceza Yeri</label>
                        <input type="text" name="ceza_yeri" class="form-control" placeholder="Örn: İstanbul, Kadıköy">
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <label class="form-label">Ceza No</label>
                        <input type="text" name="ceza_no" class="form-control" placeholder="Resmi tutanak numarası">
                    </div>
                    <div class="col-md-8">
                        <label class="form-label">Açıklama</label>
                        <input type="text" name="ceza_aciklama" class="form-control" placeholder="Ceza detayları">
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-warning">
                <h5 class="mb-0">Tutar ve Ödeme Bilgileri</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">Ceza Tutarı <span class="text-danger">*</span></label>
                        <input type="number" name="ceza_tutari" id="ceza_tutari" class="form-control" 
                               step="0.01" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">İndirimli Tutar</label>
                        <input type="number" name="indirimli_tutar" class="form-control" step="0.01">
                        <small class="text-muted">Erken ödeme indirimi varsa</small>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Para Birimi</label>
                        <select name="para_birimi" class="form-select">
                            <option value="TRY">TRY</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Sorumluluk</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <label class="form-label">Sorumlu Taraf</label>
                        <select name="sorumlu" class="form-select">
                            <option value="Çalışan">Çalışan</option>
                            <option value="Şirket">Şirket</option>
                            <option value="Belirsiz">Belirsiz</option>
                        </select>
                        <small class="text-muted">Ceza kimin sorumluluğunda</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Belge</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-12">
                        <label class="form-label">Ceza Belgesi (PDF/Fotoğraf)</label>
                        <input type="file" name="ceza_belgesi" class="form-control" accept="image/*,.pdf">
                        <small class="text-muted">Trafik cezası tutanağı, fotoğraf</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <label class="form-label">Notlar</label>
                <textarea name="notlar" class="form-control" rows="3"></textarea>
            </div>
        </div>

        <div class="mb-4">
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-save"></i> Kaydet
            </button>
            <a href="{{ url_for('filo_trafik_cezalari') }}" class="btn btn-secondary btn-lg">
                <i class="bi bi-x"></i> İptal
            </a>
        </div>
    </form>
</div>

<script>
// Ceza türü seçildiğinde varsayılan tutarı doldur
document.getElementById('ceza_turu_select')?.addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    const tutar = selectedOption.getAttribute('data-tutar');
    if (tutar && tutar !== '0.00') {
        document.getElementById('ceza_tutari').value = tutar;
    }
});
</script>
{% endblock %}