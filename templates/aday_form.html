{% extends "base.html" %}

{% block title %}Yeni Aday Ekle - İK Yönetim Sistemi{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-12">
        <h2><i class="bi bi-person-plus"></i> Yeni Aday Ekle</h2>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <form method="POST" action="{{ url_for('aday_ekle') }}">
                    
                    <!-- Kadro Seçimi -->
                    <div class="mb-3">
                        <label for="kadro_id" class="form-label">Kadro *</label>
                        <select class="form-select" id="kadro_id" name="kadro_id" required>
                            <option value="">Kadro Seçin...</option>
                            {% for kadro in kadrolar %}
                            <option value="{{ kadro.id }}">
                                {{ kadro.proje_adi }} - {{ kadro.pozisyon_adi }} - 
                                {{ kadro.il_adi }}{% if kadro.ilce_adi %}/{{ kadro.ilce_adi }}{% endif %}
                                {% if kadro.magaza_adi %} - {{ kadro.magaza_adi }}{% endif %}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Ad Soyad -->
                    <div class="mb-3">
                        <label for="ad_soyad" class="form-label">Ad Soyad *</label>
                        <input type="text" class="form-control" id="ad_soyad" name="ad_soyad" required>
                    </div>

                    <!-- Telefon -->
                    <div class="mb-3">
                        <label for="telefon" class="form-label">Telefon</label>
                        <input type="tel" class="form-control" id="telefon" name="telefon" 
                               placeholder="05XX XXX XX XX">
                    </div>

                    <!-- Email -->
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email">
                    </div>

                    <!-- TC Kimlik -->
                    <div class="mb-3">
                        <label for="tc_kimlik" class="form-label">TC Kimlik No</label>
                        <input type="text" class="form-control" id="tc_kimlik" name="tc_kimlik" 
                               maxlength="11" pattern="[0-9]{11}" 
                               placeholder="11 haneli TC Kimlik No">
                    </div>
					
                    <!-- Doğum Tarihi ve Yaş -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="dogum_tarihi" class="form-label">
                                <i class="bi bi-calendar-event"></i> Doğum Tarihi
                            </label>
                            <input type="date" 
                                   class="form-control" 
                                   id="dogum_tarihi" 
                                   name="dogum_tarihi">
                            <small class="text-muted">Doğum tarihini seçin</small>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                <i class="bi bi-calculator"></i> Yaş
                            </label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="yas_goster" readonly 
                                       style="background-color: #e9ecef; font-weight: bold; font-size: 20px; color: #6c757d; text-align: center;"
                                       placeholder="--.-">
                                <span class="input-group-text bg-success text-white">
                                    <i class="bi bi-cake2"></i>
                                </span>
                            </div>
                            <small class="text-muted" id="yas_detay">Doğum tarihi seçilince hesaplanacak</small>
                        </div>
                    </div>

                    <!-- KAYNAK SEÇİMİ -->
                    <div class="mb-3">
                        <label for="kaynak_id" class="form-label">
                            <i class="bi bi-diagram-3"></i> Kaynak
                        </label>
                        <select class="form-select" id="kaynak_id" name="kaynak_id">
                            <option value="">Kaynak Seçin...</option>
                            {% for kaynak in kaynaklar %}
                            <option value="{{ kaynak.id }}">{{ kaynak.kaynak_adi }}</option>
                            {% endfor %}
                            <option value="-1">Diğer (Manuel Giriş)</option>
                        </select>
                        <small class="text-muted">Adayı nereden buldunuz?</small>
                    </div>

                    <!-- Manuel Kaynak Girişi -->
                    <div class="mb-3" id="kaynak_diger_div" style="display: none;">
                        <label for="kaynak_diger" class="form-label">Diğer Kaynak</label>
                        <input type="text" class="form-control" id="kaynak_diger" name="kaynak_diger" 
                               placeholder="Kaynak adını yazın">
                    </div>

                    <!-- Notlar -->
                    <div class="mb-3">
                        <label for="notlar" class="form-label">Notlar</label>
                        <textarea class="form-control" id="notlar" name="notlar" rows="3"></textarea>
                    </div>

                    <!-- Butonlar -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('adaylar') }}" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> İptal
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Kaydet
                        </button>
                    </div>

                </form>
            </div>
        </div>
    </div>

    <!-- Yardım Paneli -->
    <div class="col-lg-4">
        <div class="card bg-light">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-info-circle"></i> Bilgilendirme</h5>
                <ul class="mb-0">
                    <li>(*) işaretli alanlar zorunludur</li>
                    <li>Telefon: 10 haneli numara girin</li>
                    <li>TC Kimlik: 11 haneli olmalıdır</li>
                    <li><strong>Doğum Tarihi:</strong> Yaş otomatik hesaplanır</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
console.log('=== YAŞ HESAPLAMA SCRIPT BAŞLADI ===');

// Global fonksiyon (HTML'den çağrılabilir)
window.hesaplaManuel = function() {
    console.log('>>> MANUEL HESAPLAMA ÇALIŞTI <<<');
    
    var dogumInput = document.getElementById('dogum_tarihi');
    var yasInput = document.getElementById('yas_goster');
    var yasDetay = document.getElementById('yas_detay');
    
    console.log('Tarih değeri:', dogumInput ? dogumInput.value : 'INPUT YOK');
    
    if (!dogumInput || !dogumInput.value) {
        if (yasInput) yasInput.value = '';
        if (yasDetay) yasDetay.textContent = 'Doğum tarihi seçilince hesaplanacak';
        return;
    }
    
    var dogum = new Date(dogumInput.value);
    var bugun = new Date();
    
    var yil = bugun.getFullYear() - dogum.getFullYear();
    var ay = bugun.getMonth() - dogum.getMonth();
    
    if (ay < 0) {
        yil--;
        ay += 12;
    }
    
    if (bugun.getDate() < dogum.getDate()) {
        ay--;
        if (ay < 0) {
            yil--;
            ay += 12;
        }
    }
    
    yasInput.value = yil + '.' + ay + ' yaş';
    yasInput.style.color = '#28a745';
    yasInput.style.fontSize = '20px';
    yasDetay.innerHTML = '<i class="bi bi-gift text-success"></i> <strong>' + yil + ' yıl ' + ay + ' ay</strong>';
    
    console.log('✅ Yaş hesaplandı:', yil + '.' + ay);
};

document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM hazır');
    
    var dogumInput = document.getElementById('dogum_tarihi');
    var yasInput = document.getElementById('yas_goster');
    var yasDetay = document.getElementById('yas_detay');
    
    console.log('dogumInput:', dogumInput);
    
    if (!dogumInput) {
        console.error('HATA: Input bulunamadı!');
        return;
    }
    
    // Max tarih ayarla
    var bugun = new Date().toISOString().split('T')[0];
    dogumInput.max = bugun;
    console.log('Max tarih ayarlandı:', bugun);
    
    // Event listener ekle
    dogumInput.addEventListener('change', function() {
        console.log('>>> CHANGE EVENT <<<', this.value);
        window.hesaplaManuel();
    });
    
    dogumInput.addEventListener('input', function() {
        console.log('>>> INPUT EVENT <<<', this.value);
        window.hesaplaManuel();
    });
    
    console.log('✅ Event listener eklendi');
    
    // Kaynak seçimi
    var kaynakSelect = document.getElementById('kaynak_id');
    if (kaynakSelect) {
        kaynakSelect.addEventListener('change', function() {
            var kaynakDigerDiv = document.getElementById('kaynak_diger_div');
            var kaynakDigerInput = document.getElementById('kaynak_diger');
            
            if (this.value === '-1') {
                kaynakDigerDiv.style.display = 'block';
                kaynakDigerInput.required = true;
            } else {
                kaynakDigerDiv.style.display = 'none';
                kaynakDigerInput.required = false;
                kaynakDigerInput.value = '';
            }
        });
    }
});
</script>
{% endblock %}