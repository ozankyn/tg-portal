{% extends "base.html" %}
{% block title %}Yeni Kadro - İK Yönetim Sistemi{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-12">
        <h2><i class="bi bi-briefcase-fill"></i> Yeni Kadro Ekle</h2>
    </div>
</div>

<div class="row">
    <div class="col-md-10">
        <div class="card">
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="proje_id" class="form-label">Proje *</label>
                            <select class="form-select" id="proje_id" name="proje_id" required>
                                <option value="">Proje Seçin</option>
                                {% for proje in projeler %}
                                <option value="{{ proje.id }}">{{ proje.proje_adi }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="pozisyon_adi" class="form-label">Pozisyon Adı *</label>
                            <input type="text" class="form-control" id="pozisyon_adi" name="pozisyon_adi" 
                                   placeholder="Ör: Kasa Görevlisi" required>
                        </div>
                    </div>
                    
                    <!-- Çalışma Şekli - YENİ -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="calisma_sekli" class="form-label">
                                <i class="bi bi-clock-history"></i> Çalışma Şekli *
                            </label>
                            <select class="form-select" id="calisma_sekli" name="calisma_sekli" required>
                                <option value="">Çalışma Şekli Seçin</option>
                                {% for sekil in calisma_sekilleri %}
                                <option value="{{ sekil.calisma_sekli }}">{{ sekil.calisma_sekli }}</option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">Tam zamanlı, yarı zamanlı vb.</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="aracli_durum" class="form-label">Araç Durumu *</label>
                            <select class="form-select" id="aracli_durum" name="aracli_durum" required>
                                <option value="Araçsız">Araçsız</option>
                                <option value="Araçlı">Araçlı</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="mudurluk_id" class="form-label">Müdürlük</label>
                            <select class="form-select" id="mudurluk_id" name="mudurluk_id">
                                <option value="">Müdürlük Seçin</option>
                                {% for mudurluk in mudurluker %}
                                <option value="{{ mudurluk.id }}">{{ mudurluk.mudurluk_adi }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="direktorluk_id" class="form-label">Direktörlük</label>
                            <select class="form-select" id="direktorluk_id" name="direktorluk_id">
                                <option value="">Direktörlük Seçin</option>
                                {% for direktorluk in direktorlukler %}
                                <option value="{{ direktorluk.id }}">{{ direktorluk.direktorluk_adi }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="il_id" class="form-label">İl *</label>
                            <select class="form-select" id="il_id" name="il_id" required>
                                <option value="">İl Seçin</option>
                                {% for il in iller %}
                                <option value="{{ il.id }}">{{ il.il_adi }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="ilce_id" class="form-label">İlçe</label>
                            <select class="form-select" id="ilce_id" name="ilce_id">
                                <option value="">Önce İl Seçin</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="hedef_kisi_sayisi" class="form-label">Hedef Kişi Sayısı *</label>
                            <input type="number" class="form-control" id="hedef_kisi_sayisi" 
                                   name="hedef_kisi_sayisi" min="1" value="1" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="magaza_adi" class="form-label">Mağaza Adı</label>
                            <input type="text" class="form-control" id="magaza_adi" name="magaza_adi" 
                                   placeholder="Ör: Migros MMM">
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Kadro Ekle
                        </button>
                        <a href="{{ url_for('kadrolar') }}" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> İptal
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// İl seçildiğinde ilçeleri getir
document.getElementById('il_id').addEventListener('change', function() {
    const ilId = this.value;
    const ilceSelect = document.getElementById('ilce_id');
    
    ilceSelect.innerHTML = '<option value="">Yükleniyor...</option>';
    
    if (ilId) {
        fetch(`/api/ilceler/${ilId}`)
            .then(response => response.json())
            .then(data => {
                ilceSelect.innerHTML = '<option value="">İlçe Seçin</option>';
                data.forEach(ilce => {
                    const option = document.createElement('option');
                    option.value = ilce.id;
                    option.textContent = ilce.ilce_adi;
                    ilceSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Hata:', error);
                ilceSelect.innerHTML = '<option value="">Hata oluştu</option>';
            });
    } else {
        ilceSelect.innerHTML = '<option value="">Önce İl Seçin</option>';
    }
});
</script>
{% endblock %}