{% extends "base.html" %}

{% block title %}Zorunlu Eğitim Takibi - TG Portal{% endblock %}
{% block page_title %}Zorunlu Eğitim Takibi{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Eksik Eğitimler -->
    <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm">
        <div class="px-5 py-4 bg-rose-500 rounded-t-xl">
            <h6 class="font-bold text-white flex items-center gap-2">
                <span class="material-symbols-outlined">warning</span>
                Eksik Zorunlu Eğitimler ({{ eksik_egitimler|length }})
            </h6>
        </div>
        {% if eksik_egitimler %}
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50 dark:bg-[#111418]">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark">Çalışan</th>
                        <th class="px-4 py-3 text-left text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark">Eğitim</th>
                        <th class="px-4 py-3"></th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-border-light dark:divide-border-dark">
                    {% for calisan, zorunlu in eksik_egitimler %}
                    <tr class="hover:bg-gray-50 dark:hover:bg-[#252b36]">
                        <td class="px-4 py-3">
                            <a href="{{ url_for('ik.detay', id=calisan.id) }}" class="font-medium text-[#111418] dark:text-white hover:text-primary">
                                {{ calisan.full_name }}
                            </a>
                            <p class="text-xs text-text-muted dark:text-text-muted-dark">{{ calisan.departman.ad if calisan.departman else '' }}</p>
                        </td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 text-xs font-bold rounded-full bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-400">{{ zorunlu.egitim_tipi.ad }}</span>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <a href="{{ url_for('egitim.liste', tip_id=zorunlu.egitim_tipi_id, tarih='gelecek') }}" class="p-1.5 border border-primary text-primary hover:bg-primary/10 rounded-lg inline-flex" title="Eğitime Ata">
                                <span class="material-symbols-outlined text-lg">add</span>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="py-12 text-center">
            <span class="material-symbols-outlined text-5xl text-emerald-400 mb-2">check_circle</span>
            <p class="text-text-muted dark:text-text-muted-dark">Eksik zorunlu eğitim yok</p>
        </div>
        {% endif %}
    </div>
    
    <!-- Yenileme Gerekli -->
    <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm">
        <div class="px-5 py-4 bg-amber-500 rounded-t-xl">
            <h6 class="font-bold text-white flex items-center gap-2">
                <span class="material-symbols-outlined">schedule</span>
                Yenileme Gerekli - 30 Gün İçinde ({{ yenileme_gerekli|length }})
            </h6>
        </div>
        {% if yenileme_gerekli %}
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50 dark:bg-[#111418]">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark">Çalışan</th>
                        <th class="px-4 py-3 text-left text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark">Eğitim</th>
                        <th class="px-4 py-3 text-left text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark">Bitiş</th>
                        <th class="px-4 py-3"></th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-border-light dark:divide-border-dark">
                    {% for calisan, zorunlu in yenileme_gerekli %}
                    <tr class="hover:bg-gray-50 dark:hover:bg-[#252b36]">
                        <td class="px-4 py-3">
                            <a href="{{ url_for('ik.detay', id=calisan.id) }}" class="font-medium text-[#111418] dark:text-white hover:text-primary">
                                {{ calisan.full_name }}
                            </a>
                        </td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 text-xs font-bold rounded-full bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400">{{ zorunlu.egitim_tipi.ad }}</span>
                        </td>
                        <td class="px-4 py-3">
                            {% set kalan_gun = (zorunlu.son_gecerlilik - today()).days %}
                            <span class="{% if kalan_gun <= 7 %}text-rose-600 font-bold{% else %}text-amber-600{% endif %}">
                                {{ zorunlu.son_gecerlilik.strftime('%d.%m.%Y') }}
                            </span>
                            <p class="text-xs text-text-muted dark:text-text-muted-dark">{{ kalan_gun }} gün kaldı</p>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <a href="{{ url_for('egitim.liste', tip_id=zorunlu.egitim_tipi_id, tarih='gelecek') }}" class="p-1.5 border border-amber-500 text-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/10 rounded-lg inline-flex" title="Eğitime Ata">
                                <span class="material-symbols-outlined text-lg">refresh</span>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="py-12 text-center">
            <span class="material-symbols-outlined text-5xl text-emerald-400 mb-2">event_available</span>
            <p class="text-text-muted dark:text-text-muted-dark">Yenileme gereken eğitim yok</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Özet -->
<div class="mt-6">
    <div class="bg-blue-50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/30 rounded-xl p-5">
        <h6 class="font-bold text-blue-900 dark:text-blue-200 flex items-center gap-2 mb-4">
            <span class="material-symbols-outlined">info</span>
            Bilgi
        </h6>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h6 class="font-medium text-blue-900 dark:text-blue-200 mb-2">Zorunlu Eğitimler:</h6>
                <p class="text-sm text-blue-800 dark:text-blue-300/80">
                    Pozisyon veya kadro bazlı tanımlanan zorunlu eğitimler, çalışan işe başladığında otomatik olarak atanır.
                    Tamamlanmayan eğitimler bu listede görüntülenir.
                </p>
            </div>
            <div>
                <h6 class="font-medium text-blue-900 dark:text-blue-200 mb-2">Yenileme Takibi:</h6>
                <p class="text-sm text-blue-800 dark:text-blue-300/80">
                    Geçerlilik süresi olan eğitimlerde (İSG, KVKK vb.) süre dolmadan 30 gün önce hatırlatma yapılır.
                    Süresi dolan eğitimler eksik eğitimler listesine düşer.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}