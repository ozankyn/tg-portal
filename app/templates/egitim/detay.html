{% extends "base.html" %}

{% block title %}{{ egitim.baslik }} - TG Portal{% endblock %}
{% block page_title %}Eğitim Detay{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Sol Panel - Eğitim Bilgileri -->
    <div class="space-y-6">
        <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm">
            <div class="px-5 py-4 border-b border-border-light dark:border-border-dark flex justify-between items-center">
                <h6 class="font-bold text-[#111418] dark:text-white flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">school</span>
                    Eğitim Bilgileri
                </h6>
                {% set durum_renk = {
                    'planli': 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400',
                    'devam_ediyor': 'bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400',
                    'tamamlandi': 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400',
                    'iptal': 'bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-400'
                } %}
                <span class="px-2 py-1 text-xs font-bold rounded-full {{ durum_renk.get(egitim.durum, 'bg-gray-100 text-gray-700') }}">
                    {{ egitim.durum|replace('_', ' ')|title }}
                </span>
            </div>
            <div class="p-5">
                <h5 class="text-lg font-bold text-[#111418] dark:text-white mb-2">{{ egitim.baslik }}</h5>
                <p class="text-sm text-text-muted dark:text-text-muted-dark mb-4">{{ egitim.aciklama or 'Açıklama girilmedi' }}</p>
                
                <div class="space-y-3 text-sm">
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-text-muted dark:text-text-muted-dark">label</span>
                        <div><strong>Tip:</strong> {{ egitim.egitim_tipi.ad }}</div>
                    </div>
                    {% if egitim.proje %}
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-text-muted dark:text-text-muted-dark">work</span>
                        <div><strong>Proje:</strong> {{ egitim.proje.musteri.display_name }} - {{ egitim.proje.ad }}</div>
                    </div>
                    {% endif %}
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-text-muted dark:text-text-muted-dark">event</span>
                        <div><strong>Tarih:</strong> {{ egitim.baslangic_tarihi.strftime('%d.%m.%Y %H:%M') }}{% if egitim.bitis_tarihi %} - {{ egitim.bitis_tarihi.strftime('%H:%M') }}{% endif %}</div>
                    </div>
                    {% if egitim.sure_saat %}
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-text-muted dark:text-text-muted-dark">schedule</span>
                        <div><strong>Süre:</strong> {{ egitim.sure_saat }} saat</div>
                    </div>
                    {% endif %}
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-text-muted dark:text-text-muted-dark">location_on</span>
                        <div>
                            <strong>Lokasyon:</strong>
                            {% if egitim.lokasyon_tipi == 'online' %}
                            <span class="ml-1 px-2 py-0.5 bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400 text-xs rounded-full">Online</span>
                            {% elif egitim.lokasyon_tipi == 'hibrit' %}
                            <span class="ml-1 px-2 py-0.5 bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400 text-xs rounded-full">Hibrit</span>
                            {% else %}
                            <span class="ml-1 px-2 py-0.5 bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 text-xs rounded-full">Yüz yüze</span>
                            {% endif %}
                            {% if egitim.lokasyon %}
                            <p class="text-text-muted dark:text-text-muted-dark text-xs mt-1">{{ egitim.lokasyon }}</p>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-text-muted dark:text-text-muted-dark">person</span>
                        <div>
                            <strong>Eğitmen:</strong>
                            {% if egitim.egitmen %}{{ egitim.egitmen.full_name }}
                            {% elif egitim.dis_egitmen_ad %}{{ egitim.dis_egitmen_ad }} <span class="text-text-muted dark:text-text-muted-dark text-xs">({{ egitim.dis_egitmen_kurum or 'Dış' }})</span>
                            {% else %}<span class="text-text-muted dark:text-text-muted-dark">Belirlenmedi</span>{% endif %}
                        </div>
                    </div>
                    {% if egitim.maliyet %}
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-text-muted dark:text-text-muted-dark">payments</span>
                        <div><strong>Maliyet:</strong> {{ "%.2f"|format(egitim.maliyet) }} ₺</div>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="px-5 py-4 border-t border-border-light dark:border-border-dark flex gap-2">
                <a href="{{ url_for('egitim.duzenle', id=egitim.id) }}" class="flex-1 px-3 py-2 border border-primary text-primary hover:bg-primary/10 font-medium text-sm rounded-lg text-center transition-colors">
                    <span class="material-symbols-outlined text-base align-middle mr-1">edit</span>Düzenle
                </a>
                <div class="relative" x-data="{ open: false }">
                    <button @click="open = !open" class="px-3 py-2 border border-border-light dark:border-border-dark hover:bg-gray-50 dark:hover:bg-[#252b36] font-medium text-sm rounded-lg transition-colors flex items-center gap-1">
                        Durum <span class="material-symbols-outlined text-base">expand_more</span>
                    </button>
                    <div x-show="open" @click.away="open = false" class="absolute right-0 mt-2 w-40 bg-white dark:bg-card-dark rounded-lg shadow-lg border border-border-light dark:border-border-dark z-10">
                        <form method="POST" action="{{ url_for('egitim.durum_degistir', id=egitim.id, durum='planli') }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-[#252b36]">Planlı</button>
                        </form>
                        <form method="POST" action="{{ url_for('egitim.durum_degistir', id=egitim.id, durum='devam_ediyor') }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-[#252b36]">Devam Ediyor</button>
                        </form>
                        <form method="POST" action="{{ url_for('egitim.durum_degistir', id=egitim.id, durum='tamamlandi') }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-[#252b36]">Tamamlandı</button>
                        </form>
                        <div class="border-t border-border-light dark:border-border-dark"></div>
                        <button onclick="document.getElementById('iptalModal').classList.remove('hidden')" class="w-full px-4 py-2 text-left text-sm text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/10">İptal Et</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Katılım İstatistikleri -->
        <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm">
            <div class="px-5 py-4 border-b border-border-light dark:border-border-dark">
                <h6 class="font-bold text-[#111418] dark:text-white flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">bar_chart</span>
                    Katılım
                </h6>
            </div>
            <div class="p-5">
                <div class="grid grid-cols-3 text-center gap-4">
                    <div>
                        <div class="text-2xl font-bold text-blue-600">{{ egitim.katilimci_sayisi }}</div>
                        <div class="text-xs text-text-muted dark:text-text-muted-dark">Davetli</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-emerald-600">{{ egitim.tamamlayan_sayisi }}</div>
                        <div class="text-xs text-text-muted dark:text-text-muted-dark">Başarılı</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-cyan-600">{% if egitim.kontenjan %}{{ egitim.doluluk_orani }}%{% else %}-{% endif %}</div>
                        <div class="text-xs text-text-muted dark:text-text-muted-dark">Doluluk</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sağ Panel -->
    <div class="lg:col-span-2">
        <!-- Tab Menü -->
        <div class="mb-4 border-b border-border-light dark:border-border-dark" x-data="{ tab: 'katilimcilar' }">
            <div class="flex gap-4">
                <button @click="tab = 'katilimcilar'" :class="tab === 'katilimcilar' ? 'border-b-2 border-primary text-primary' : 'text-text-muted dark:text-text-muted-dark'" class="pb-3 px-1 font-medium text-sm flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg">groups</span>
                    Katılımcılar ({{ katilimcilar|length }})
                </button>
                <button @click="tab = 'materyaller'" :class="tab === 'materyaller' ? 'border-b-2 border-primary text-primary' : 'text-text-muted dark:text-text-muted-dark'" class="pb-3 px-1 font-medium text-sm flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg">folder</span>
                    Materyaller ({{ materyaller|length }})
                </button>
            </div>
        
            <!-- Katılımcılar Tab -->
            <div x-show="tab === 'katilimcilar'" class="pt-4">
                <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm">
                    <div class="px-5 py-4 border-b border-border-light dark:border-border-dark flex justify-between items-center">
                        <h6 class="font-bold text-[#111418] dark:text-white">Katılımcı Listesi</h6>
                        <div class="flex gap-2">
                            <button onclick="document.getElementById('katilimciEkleModal').classList.remove('hidden')" class="px-3 py-1.5 bg-primary hover:bg-primary-dark text-white font-medium text-sm rounded-lg transition-colors flex items-center gap-1">
                                <span class="material-symbols-outlined text-lg">add</span>Ekle
                            </button>
                            {% if egitim.proje %}
                            <button onclick="document.getElementById('topluEkleModal').classList.remove('hidden')" class="px-3 py-1.5 border border-primary text-primary hover:bg-primary/10 font-medium text-sm rounded-lg transition-colors flex items-center gap-1">
                                <span class="material-symbols-outlined text-lg">group_add</span>Toplu
                            </button>
                            {% endif %}
                        </div>
                    </div>
                    {% if katilimcilar %}
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 dark:bg-[#111418]">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark">Çalışan</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark hidden md:table-cell">Departman</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark">Durum</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark hidden sm:table-cell">Puan</th>
                                    <th class="px-4 py-3 text-left text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark hidden lg:table-cell">Sertifika</th>
                                    <th class="px-4 py-3 text-right text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark">İşlem</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-border-light dark:divide-border-dark">
                                {% for k in katilimcilar %}
                                <tr class="hover:bg-gray-50 dark:hover:bg-[#252b36]">
                                    <td class="px-4 py-3">
                                        <a href="{{ url_for('ik.detay', id=k.calisan_id) }}" class="font-medium text-[#111418] dark:text-white hover:text-primary">{{ k.calisan.full_name }}</a>
                                    </td>
                                    <td class="px-4 py-3 hidden md:table-cell text-sm text-text-muted dark:text-text-muted-dark">{{ k.calisan.departman.ad if k.calisan.departman else '-' }}</td>
                                    <td class="px-4 py-3">
                                        <span class="px-2 py-1 text-xs font-bold rounded-full bg-{{ k.durum_renk }}-100 text-{{ k.durum_renk }}-700 dark:bg-{{ k.durum_renk }}-900/30 dark:text-{{ k.durum_renk }}-400">{{ k.durum_text }}</span>
                                    </td>
                                    <td class="px-4 py-3 hidden sm:table-cell text-sm">{{ k.puan if k.puan else '-' }}</td>
                                    <td class="px-4 py-3 hidden lg:table-cell">
                                        {% if k.sertifika_tarihi %}
                                        <span class="material-symbols-outlined text-emerald-500" title="{{ k.sertifika_tarihi.strftime('%d.%m.%Y') }}">verified</span>
                                        {% if k.sertifika_gecerlilik %}
                                        <span class="text-xs text-text-muted dark:text-text-muted-dark">{{ k.sertifika_gecerlilik.strftime('%d.%m.%Y') }}'e kadar</span>
                                        {% endif %}
                                        {% else %}-{% endif %}
                                    </td>
                                    <td class="px-4 py-3 text-right">
                                        <div class="relative" x-data="{ open: false }">
                                            <button @click="open = !open" class="p-1.5 hover:bg-gray-100 dark:hover:bg-[#252b36] rounded-lg">
                                                <span class="material-symbols-outlined">more_vert</span>
                                            </button>
                                            <div x-show="open" @click.away="open = false" class="absolute right-0 mt-1 w-36 bg-white dark:bg-card-dark rounded-lg shadow-lg border border-border-light dark:border-border-dark z-10">
                                                <button onclick="updateKatilimci({{ k.id }}, 'katildi')" class="w-full px-3 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-[#252b36]">Katıldı</button>
                                                <button onclick="updateKatilimci({{ k.id }}, 'gecti')" class="w-full px-3 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-[#252b36]">Başarılı</button>
                                                <button onclick="updateKatilimci({{ k.id }}, 'kaldi')" class="w-full px-3 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-[#252b36]">Başarısız</button>
                                                <button onclick="updateKatilimci({{ k.id }}, 'mazeret')" class="w-full px-3 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-[#252b36]">Mazeretli</button>
                                                <div class="border-t border-border-light dark:border-border-dark"></div>
                                                <form method="POST" action="{{ url_for('egitim.katilimci_sil', id=k.id) }}" onsubmit="return confirm('Silmek istediğinize emin misiniz?')">
                                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                                    <button type="submit" class="w-full px-3 py-2 text-left text-sm text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/10">Sil</button>
                                                </form>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="py-12 text-center">
                        <span class="material-symbols-outlined text-5xl text-gray-300 dark:text-gray-600 mb-2">groups</span>
                        <p class="text-text-muted dark:text-text-muted-dark">Henüz katılımcı eklenmedi</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Materyaller Tab -->
            <div x-show="tab === 'materyaller'" class="pt-4">
                <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm">
                    <div class="px-5 py-4 border-b border-border-light dark:border-border-dark flex justify-between items-center">
                        <h6 class="font-bold text-[#111418] dark:text-white">Eğitim Materyalleri</h6>
                        <button onclick="document.getElementById('materyalModal').classList.remove('hidden')" class="px-3 py-1.5 bg-primary hover:bg-primary-dark text-white font-medium text-sm rounded-lg transition-colors flex items-center gap-1">
                            <span class="material-symbols-outlined text-lg">upload</span>Ekle
                        </button>
                    </div>
                    <div class="p-5">
                        {% if materyaller %}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {% for m in materyaller %}
                            <div class="border border-border-light dark:border-border-dark rounded-xl p-4">
                                <div class="flex items-start gap-3">
                                    {% if m.materyal_tipi == 'video' %}
                                    <div class="w-10 h-10 bg-rose-100 dark:bg-rose-900/30 rounded-lg flex items-center justify-center">
                                        <span class="material-symbols-outlined text-rose-600">play_circle</span>
                                    </div>
                                    {% elif m.materyal_tipi == 'sunum' %}
                                    <div class="w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center">
                                        <span class="material-symbols-outlined text-amber-600">slideshow</span>
                                    </div>
                                    {% elif m.materyal_tipi == 'gorsel' %}
                                    <div class="w-10 h-10 bg-cyan-100 dark:bg-cyan-900/30 rounded-lg flex items-center justify-center">
                                        <span class="material-symbols-outlined text-cyan-600">image</span>
                                    </div>
                                    {% elif m.materyal_tipi == 'link' %}
                                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                                        <span class="material-symbols-outlined text-blue-600">link</span>
                                    </div>
                                    {% else %}
                                    <div class="w-10 h-10 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center">
                                        <span class="material-symbols-outlined text-gray-600">description</span>
                                    </div>
                                    {% endif %}
                                    <div class="flex-1">
                                        <h6 class="font-medium text-[#111418] dark:text-white">{{ m.ad }}</h6>
                                        {% if m.aciklama %}
                                        <p class="text-xs text-text-muted dark:text-text-muted-dark mt-1">{{ m.aciklama }}</p>
                                        {% endif %}
                                        {% if m.dosya_boyut %}
                                        <span class="text-xs text-text-muted dark:text-text-muted-dark">
                                            {% if m.dosya_boyut > 1048576 %}{{ (m.dosya_boyut / 1048576)|round(2) }} MB{% else %}{{ (m.dosya_boyut / 1024)|round(1) }} KB{% endif %}
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="flex gap-2 mt-3">
                                    <a href="{{ url_for('egitim.materyal_goruntule', id=m.id) }}" class="flex-1 px-3 py-1.5 border border-primary text-primary hover:bg-primary/10 text-xs font-medium rounded-lg text-center">Görüntüle</a>
                                    {% if m.dosya_yolu %}
                                    <a href="{{ url_for('egitim.materyal_indir', id=m.id) }}" class="p-1.5 border border-border-light dark:border-border-dark hover:bg-gray-50 dark:hover:bg-[#252b36] rounded-lg">
                                        <span class="material-symbols-outlined text-lg">download</span>
                                    </a>
                                    {% endif %}
                                    <form method="POST" action="{{ url_for('egitim.materyal_sil', id=m.id) }}" onsubmit="return confirm('Silmek istediğinize emin misiniz?')">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button type="submit" class="p-1.5 border border-rose-200 text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/10 rounded-lg">
                                            <span class="material-symbols-outlined text-lg">delete</span>
                                        </button>
                                    </form>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="py-12 text-center">
                            <span class="material-symbols-outlined text-5xl text-gray-300 dark:text-gray-600 mb-2">folder</span>
                            <p class="text-text-muted dark:text-text-muted-dark">Henüz materyal eklenmedi</p>
                            <p class="text-xs text-text-muted dark:text-text-muted-dark mt-1">PDF, PowerPoint, video veya harici link ekleyebilirsiniz.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Katılımcı Ekle Modal -->
<div id="katilimciEkleModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-card-dark rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden">
        <form method="POST" action="{{ url_for('egitim.katilimci_ekle', id=egitim.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="px-6 py-4 border-b border-border-light dark:border-border-dark flex justify-between items-center">
                <h5 class="font-bold text-lg text-[#111418] dark:text-white">Katılımcı Ekle</h5>
                <button type="button" onclick="this.closest('.fixed').classList.add('hidden')" class="p-1 hover:bg-gray-100 dark:hover:bg-[#252b36] rounded-lg">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="p-6">
                <label class="block mb-2 text-sm font-medium text-[#111418] dark:text-white">Çalışanlar</label>
                <select name="calisan_ids" multiple size="10" required class="w-full p-2 bg-gray-50 dark:bg-[#111418] border border-border-light dark:border-border-dark rounded-lg text-sm">
                    {% for c in eklenebilir_calisanlar %}
                    <option value="{{ c.id }}">{{ c.full_name }} - {{ c.departman.ad if c.departman else 'Departman yok' }}</option>
                    {% endfor %}
                </select>
                <p class="text-xs text-text-muted dark:text-text-muted-dark mt-1">Ctrl/Cmd tuşu ile birden fazla seçebilirsiniz</p>
            </div>
            <div class="px-6 py-4 border-t border-border-light dark:border-border-dark flex justify-end gap-3">
                <button type="button" onclick="this.closest('.fixed').classList.add('hidden')" class="px-4 py-2 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 font-medium rounded-lg transition-colors">İptal</button>
                <button type="submit" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white font-bold rounded-lg transition-colors">Ekle</button>
            </div>
        </form>
    </div>
</div>

<!-- Toplu Ekle Modal -->
{% if egitim.proje %}
<div id="topluEkleModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-card-dark rounded-xl w-full max-w-md">
        <form method="POST" action="{{ url_for('egitim.toplu_katilimci', id=egitim.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="px-6 py-4 border-b border-border-light dark:border-border-dark flex justify-between items-center">
                <h5 class="font-bold text-lg text-[#111418] dark:text-white">Toplu Katılımcı Ekle</h5>
                <button type="button" onclick="this.closest('.fixed').classList.add('hidden')" class="p-1 hover:bg-gray-100 dark:hover:bg-[#252b36] rounded-lg">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="p-6">
                <label class="block mb-2 text-sm font-medium text-[#111418] dark:text-white">Kaynak</label>
                <label class="flex items-center gap-2 mb-2 cursor-pointer">
                    <input type="radio" name="kaynak" value="proje" checked class="w-4 h-4 text-primary">
                    <span class="text-sm">Tüm proje çalışanları</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="kaynak" value="kadro" class="w-4 h-4 text-primary">
                    <span class="text-sm">Belirli kadrodan</span>
                </label>
                <input type="hidden" name="kaynak_id" value="{{ egitim.proje_id }}">
            </div>
            <div class="px-6 py-4 border-t border-border-light dark:border-border-dark flex justify-end gap-3">
                <button type="button" onclick="this.closest('.fixed').classList.add('hidden')" class="px-4 py-2 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 font-medium rounded-lg transition-colors">İptal</button>
                <button type="submit" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white font-bold rounded-lg transition-colors">Tümünü Ekle</button>
            </div>
        </form>
    </div>
</div>
{% endif %}

<!-- Materyal Ekle Modal -->
<div id="materyalModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-card-dark rounded-xl w-full max-w-md">
        <form method="POST" action="{{ url_for('egitim.materyal_yukle', id=egitim.id) }}" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="px-6 py-4 border-b border-border-light dark:border-border-dark flex justify-between items-center">
                <h5 class="font-bold text-lg text-[#111418] dark:text-white">Materyal Ekle</h5>
                <button type="button" onclick="this.closest('.fixed').classList.add('hidden')" class="p-1 hover:bg-gray-100 dark:hover:bg-[#252b36] rounded-lg">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="p-6 space-y-4" x-data="{ mode: 'dosya' }">
                <div class="flex gap-2">
                    <button type="button" @click="mode = 'dosya'" :class="mode === 'dosya' ? 'bg-primary text-white' : 'bg-gray-100 dark:bg-gray-800'" class="flex-1 py-2 text-sm font-medium rounded-lg transition-colors">
                        <span class="material-symbols-outlined text-base align-middle mr-1">upload</span>Dosya Yükle
                    </button>
                    <button type="button" @click="mode = 'link'" :class="mode === 'link' ? 'bg-primary text-white' : 'bg-gray-100 dark:bg-gray-800'" class="flex-1 py-2 text-sm font-medium rounded-lg transition-colors">
                        <span class="material-symbols-outlined text-base align-middle mr-1">link</span>Link Ekle
                    </button>
                </div>
                
                <div x-show="mode === 'dosya'">
                    <label class="block mb-2 text-sm font-medium text-[#111418] dark:text-white">Dosya *</label>
                    <input type="file" name="dosya" accept=".pdf,.ppt,.pptx,.doc,.docx,.xls,.xlsx,.mp4,.webm,.jpg,.jpeg,.png,.gif" class="w-full p-2 border border-border-light dark:border-border-dark rounded-lg text-sm">
                    <p class="text-xs text-text-muted dark:text-text-muted-dark mt-1">PDF, Office, Video veya Görsel dosyaları</p>
                </div>
                
                <div x-show="mode === 'link'">
                    <label class="block mb-2 text-sm font-medium text-[#111418] dark:text-white">Link *</label>
                    <input type="url" name="harici_link" placeholder="https://..." class="w-full p-2.5 bg-gray-50 dark:bg-[#111418] border border-border-light dark:border-border-dark rounded-lg text-sm">
                    <p class="text-xs text-text-muted dark:text-text-muted-dark mt-1">YouTube, Vimeo, Google Docs, Loom veya herhangi bir URL</p>
                </div>
                
                <div>
                    <label class="block mb-2 text-sm font-medium text-[#111418] dark:text-white">Başlık</label>
                    <input type="text" name="ad" placeholder="Boş bırakılırsa dosya adı kullanılır" class="w-full p-2.5 bg-gray-50 dark:bg-[#111418] border border-border-light dark:border-border-dark rounded-lg text-sm">
                </div>
                
                <div>
                    <label class="block mb-2 text-sm font-medium text-[#111418] dark:text-white">Açıklama</label>
                    <textarea name="aciklama" rows="2" placeholder="İsteğe bağlı" class="w-full p-2.5 bg-gray-50 dark:bg-[#111418] border border-border-light dark:border-border-dark rounded-lg text-sm"></textarea>
                </div>
            </div>
            <div class="px-6 py-4 border-t border-border-light dark:border-border-dark flex justify-end gap-3">
                <button type="button" onclick="this.closest('.fixed').classList.add('hidden')" class="px-4 py-2 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 font-medium rounded-lg transition-colors">İptal</button>
                <button type="submit" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white font-bold rounded-lg transition-colors">Yükle</button>
            </div>
        </form>
    </div>
</div>

<!-- İptal Modal -->
<div id="iptalModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-card-dark rounded-xl w-full max-w-md">
        <form method="POST" action="{{ url_for('egitim.durum_degistir', id=egitim.id, durum='iptal') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="px-6 py-4 border-b border-border-light dark:border-border-dark flex justify-between items-center">
                <h5 class="font-bold text-lg text-[#111418] dark:text-white">Eğitimi İptal Et</h5>
                <button type="button" onclick="this.closest('.fixed').classList.add('hidden')" class="p-1 hover:bg-gray-100 dark:hover:bg-[#252b36] rounded-lg">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="p-6">
                <label class="block mb-2 text-sm font-medium text-[#111418] dark:text-white">İptal Nedeni</label>
                <textarea name="iptal_nedeni" rows="3" required class="w-full p-2.5 bg-gray-50 dark:bg-[#111418] border border-border-light dark:border-border-dark rounded-lg text-sm"></textarea>
            </div>
            <div class="px-6 py-4 border-t border-border-light dark:border-border-dark flex justify-end gap-3">
                <button type="button" onclick="this.closest('.fixed').classList.add('hidden')" class="px-4 py-2 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 font-medium rounded-lg transition-colors">Vazgeç</button>
                <button type="submit" class="px-4 py-2 bg-rose-500 hover:bg-rose-600 text-white font-bold rounded-lg transition-colors">İptal Et</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<script>
function updateKatilimci(id, durum) {
    fetch(`/egitim/katilimci/${id}/durum`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': '{{ csrf_token() }}'
        },
        body: `durum=${durum}`
    }).then(response => {
        if (response.ok) location.reload();
    });
}
</script>
{% endblock %}