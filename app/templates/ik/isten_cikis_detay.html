{% extends "base.html" %}

{% block title %}İşten Çıkış Detay - {{ cikis.calisan.full_name }}{% endblock %}
{% block page_title %}İşten Çıkış Detay{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <!-- Çıkış Bilgileri -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>Çıkış Bilgileri</h6>
                <span class="badge bg-{{ cikis.durum_renk }}">{{ cikis.durum|title }}</span>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-sm table-borderless">
                            <tr>
                                <td class="text-muted" width="40%">Çıkış Tipi</td>
                                <td><strong>{{ cikis.cikis_tipi|title }}</strong></td>
                            </tr>
                            <tr>
                                <td class="text-muted">Çıkış Sebebi</td>
                                <td>{{ cikis.cikis_sebebi or '-' }}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Talep Tarihi</td>
                                <td>{{ cikis.talep_tarihi.strftime('%d.%m.%Y') if cikis.talep_tarihi else '-' }}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-sm table-borderless">
                            <tr>
                                <td class="text-muted" width="40%">Planlanan Tarih</td>
                                <td>{{ cikis.planlanan_cikis_tarihi.strftime('%d.%m.%Y') }}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Gerçekleşen</td>
                                <td>{{ cikis.gerceklesen_cikis_tarihi.strftime('%d.%m.%Y') if cikis.gerceklesen_cikis_tarihi else '-' }}</td>
                            </tr>
                        </table>
                    </div>
                </div>
                {% if cikis.detay_notu %}
                <div class="mt-3">
                    <strong>Detay:</strong>
                    <p class="text-muted mb-0">{{ cikis.detay_notu }}</p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Checklist -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-check2-square me-2"></i>Çıkış Kontrol Listesi</h6>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('ik.isten_cikis_guncelle', id=cikis.id) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <div class="row g-3">
                        <div class="col-12">
                            <div class="form-check form-switch">
                                <input type="checkbox" name="zimmet_teslim" class="form-check-input" id="zimmetCheck" 
                                       {{ 'checked' if cikis.zimmet_teslim }}>
                                <label class="form-check-label" for="zimmetCheck">
                                    <strong>Zimmet Teslimi</strong>
                                    <small class="text-muted d-block">Şirket malzemeleri (bilgisayar, telefon, araç vb.) teslim alındı</small>
                                </label>
                            </div>
                            <input type="text" name="zimmet_notu" class="form-control form-control-sm mt-2" 
                                   placeholder="Zimmet notu..." value="{{ cikis.zimmet_notu or '' }}">
                        </div>
                        
                        <div class="col-12">
                            <div class="form-check form-switch">
                                <input type="checkbox" name="sgk_cikis_bildirimi" class="form-check-input" id="sgkCheck"
                                       {{ 'checked' if cikis.sgk_cikis_bildirimi }}>
                                <label class="form-check-label" for="sgkCheck">
                                    <strong>SGK Çıkış Bildirimi</strong>
                                    <small class="text-muted d-block">SGK işten ayrılış bildirimi yapıldı</small>
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <div class="form-check form-switch">
                                <input type="checkbox" name="cikis_mulakati_yapildi" class="form-check-input" id="mulakatCheck"
                                       {{ 'checked' if cikis.cikis_mulakati_yapildi }}>
                                <label class="form-check-label" for="mulakatCheck">
                                    <strong>Çıkış Mülakatı</strong>
                                    <small class="text-muted d-block">Çalışan ile çıkış mülakatı gerçekleştirildi</small>
                                </label>
                            </div>
                            <textarea name="cikis_mulakat_notu" class="form-control form-control-sm mt-2" rows="2"
                                      placeholder="Mülakat notları...">{{ cikis.cikis_mulakat_notu or '' }}</textarea>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Kıdem Tazminatı (₺)</label>
                            <input type="number" name="kidem_tazminati" class="form-control" step="0.01"
                                   value="{{ cikis.kidem_tazminati or '' }}">
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">İhbar Tazminatı (₺)</label>
                            <input type="number" name="ihbar_tazminati" class="form-control" step="0.01"
                                   value="{{ cikis.ihbar_tazminati or '' }}">
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-lg me-2"></i>Kaydet
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Tamamla -->
        {% if cikis.durum != 'tamamlandi' %}
        <div class="card">
            <div class="card-body">
                <form method="POST" action="{{ url_for('ik.isten_cikis_tamamla', id=cikis.id) }}" 
                      onsubmit="return confirm('İşten çıkış işlemini tamamlamak istediğinize emin misiniz? Bu işlem çalışanın durumunu AYRILDI olarak değiştirecektir.')">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-check-circle me-2"></i>İşten Çıkışı Tamamla
                    </button>
                </form>
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="col-lg-4">
        <!-- Çalışan Bilgileri -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-person me-2"></i>Çalışan</h6>
            </div>
            <div class="card-body text-center">
                <div class="rounded-circle bg-secondary d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                    <i class="bi bi-person fs-3 text-white"></i>
                </div>
                <h5>{{ cikis.calisan.full_name }}</h5>
                <p class="text-muted mb-0">{{ cikis.calisan.pozisyon.ad if cikis.calisan.pozisyon else '-' }}</p>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between">
                    <span>Sicil No</span>
                    <strong>{{ cikis.calisan.sicil_no or '-' }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                    <span>İşe Giriş</span>
                    <span>{{ cikis.calisan.ise_baslama.strftime('%d.%m.%Y') if cikis.calisan.ise_baslama else '-' }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                    <span>Kıdem</span>
                    <span>{{ cikis.calisan.kidem_yili }} yıl</span>
                </li>
            </ul>
        </div>
        
        <!-- İlerleme -->
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-pie-chart me-2"></i>İlerleme</h6>
            </div>
            <div class="card-body">
                <div class="text-center mb-3">
                    <div class="display-4 fw-bold text-{{ 'success' if cikis.tamamlanma_yuzdesi == 100 else 'warning' }}">
                        %{{ cikis.tamamlanma_yuzdesi }}
                    </div>
                    <small class="text-muted">Tamamlandı</small>
                </div>
                <div class="progress" style="height: 10px;">
                    <div class="progress-bar bg-{{ 'success' if cikis.tamamlanma_yuzdesi == 100 else 'warning' }}" 
                         style="width: {{ cikis.tamamlanma_yuzdesi }}%"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
