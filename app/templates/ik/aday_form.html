{% extends "base.html" %}

{% block title %}{% if aday %}Aday Düzenle{% else %}Yeni Aday{% endif %} - TG Portal{% endblock %}
{% block page_title %}{% if aday %}Aday Düzenle{% else %}Yeni Aday Ekle{% endif %}{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2">
        <div class="bg-white dark:bg-card-dark rounded-lg border border-border-light dark:border-border-dark">
            <div class="p-6">
                <form method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <!-- Kişisel Bilgiler -->
                    <h6 class="flex items-center gap-2 text-xs font-semibold text-text-muted dark:text-text-muted-dark uppercase tracking-wide mb-4">
                        <span class="material-symbols-outlined text-sm">person</span>
                        Kişisel Bilgiler
                    </h6>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">Ad *</label>
                            <input type="text" name="ad" required value="{{ aday.ad if aday else '' }}"
                                   class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">Soyad *</label>
                            <input type="text" name="soyad" required value="{{ aday.soyad if aday else '' }}"
                                   class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">TC Kimlik No</label>
                            <input type="text" name="tc_kimlik" maxlength="11" pattern="[0-9]{11}" title="11 haneli TC Kimlik numarası"
                                   value="{{ aday.tc_kimlik if aday else '' }}"
                                   class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">Doğum Tarihi</label>
                            <input type="date" name="dogum_tarihi" value="{{ aday.dogum_tarihi.strftime('%Y-%m-%d') if aday and aday.dogum_tarihi else '' }}"
                                   class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">Cinsiyet</label>
                            <select name="cinsiyet" class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Seçiniz</option>
                                <option value="erkek" {{ 'selected' if aday and aday.cinsiyet == 'erkek' }}>Erkek</option>
                                <option value="kadin" {{ 'selected' if aday and aday.cinsiyet == 'kadin' }}>Kadın</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- İletişim Bilgileri -->
                    <h6 class="flex items-center gap-2 text-xs font-semibold text-text-muted dark:text-text-muted-dark uppercase tracking-wide mb-4">
                        <span class="material-symbols-outlined text-sm">call</span>
                        İletişim Bilgileri
                    </h6>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">Telefon *</label>
                            <input type="tel" name="telefon" required placeholder="5XX XXX XX XX" value="{{ aday.telefon if aday else '' }}"
                                   class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">E-posta</label>
                            <input type="email" name="email" value="{{ aday.email if aday else '' }}"
                                   class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">Adres</label>
                            <textarea name="adres" rows="2" class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">{{ aday.adres if aday else '' }}</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">İl</label>
                            <input type="text" name="il" value="{{ aday.il if aday else '' }}"
                                   class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">İlçe</label>
                            <input type="text" name="ilce" value="{{ aday.ilce if aday else '' }}"
                                   class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    
                    <!-- Başvuru Bilgileri -->
                    <h6 class="flex items-center gap-2 text-xs font-semibold text-text-muted dark:text-text-muted-dark uppercase tracking-wide mb-4">
                        <span class="material-symbols-outlined text-sm">work</span>
                        Başvuru Bilgileri
                    </h6>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">Pozisyon</label>
                            <select name="pozisyon_id" class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Seçiniz</option>
                                {% for pozisyon in pozisyonlar %}
                                <option value="{{ pozisyon.id }}" {{ 'selected' if aday and aday.pozisyon_id == pozisyon.id }}>{{ pozisyon.ad }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">Kaynak</label>
                            <select name="kaynak" class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="manuel" {{ 'selected' if not aday or aday.kaynak == 'manuel' }}>Manuel Giriş</option>
                                <option value="referans" {{ 'selected' if aday and aday.kaynak == 'referans' }}>Referans</option>
                                <option value="kariyer_sitesi" {{ 'selected' if aday and aday.kaynak == 'kariyer_sitesi' }}>Kariyer Sitesi</option>
                                <option value="sosyal_medya" {{ 'selected' if aday and aday.kaynak == 'sosyal_medya' }}>Sosyal Medya</option>
                                <option value="ilan" {{ 'selected' if aday and aday.kaynak == 'ilan' }}>İlan</option>
                                <option value="sirket_web" {{ 'selected' if aday and aday.kaynak == 'sirket_web' }}>Şirket Web Sitesi</option>
                                <option value="sms_davet" {{ 'selected' if aday and aday.kaynak == 'sms_davet' }}>SMS Davet</option>
                                <option value="diger" {{ 'selected' if aday and aday.kaynak == 'diger' }}>Diğer</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-text-primary dark:text-text-primary-dark mb-1">Değerlendirme Notu</label>
                            <textarea name="degerlendirme_notu" rows="3" placeholder="Aday hakkında notlar..."
                                      class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">{{ aday.degerlendirme_notu if aday else '' }}</textarea>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3 pt-4 border-t border-border-light dark:border-border-dark">
                        <button type="submit" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <span class="material-symbols-outlined text-sm">check</span>
                            {{ 'Güncelle' if aday else 'Kaydet' }}
                        </button>
                        <a href="{{ url_for('ik.aday_liste') }}" class="px-4 py-2 border border-border-light dark:border-border-dark text-text-primary dark:text-text-primary-dark rounded-lg hover:bg-gray-50 dark:hover:bg-[#252b36] transition-colors">İptal</a>
                        {% if aday %}
                        <a href="{{ url_for('ik.aday_detay', id=aday.id) }}" class="inline-flex items-center gap-1 px-4 py-2 border border-border-light dark:border-border-dark text-text-primary dark:text-text-primary-dark rounded-lg hover:bg-gray-50 dark:hover:bg-[#252b36] transition-colors">
                            <span class="material-symbols-outlined text-sm">visibility</span>
                            Detaya Dön
                        </a>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="space-y-4">
        <div class="bg-white dark:bg-card-dark rounded-lg border border-border-light dark:border-border-dark">
            <div class="px-5 py-4 border-b border-border-light dark:border-border-dark">
                <h3 class="font-semibold text-text-primary dark:text-text-primary-dark flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg">info</span>
                    Bilgi
                </h3>
            </div>
            <div class="p-5">
                <p class="text-sm text-text-muted dark:text-text-muted-dark mb-3">
                    {% if aday %}
                    Aday bilgilerini güncelleyebilirsiniz. Evrak yükleme ve durum değişikliği için detay sayfasını kullanın.
                    {% else %}
                    Manuel aday kaydı oluşturuyorsunuz. Bu durumda KVKK onayı alınmış kabul edilir.
                    {% endif %}
                </p>
                <ul class="text-sm text-text-muted dark:text-text-muted-dark space-y-1">
                    <li class="flex items-center gap-1"><span class="material-symbols-outlined text-xs">check</span> Telefon numarası benzersiz olmalıdır</li>
                    <li class="flex items-center gap-1"><span class="material-symbols-outlined text-xs">check</span> TC Kimlik 11 haneli olmalıdır</li>
                    {% if not aday %}
                    <li class="flex items-center gap-1"><span class="material-symbols-outlined text-xs">check</span> SMS ile davet için "Kadro" modülünü kullanın</li>
                    {% endif %}
                </ul>
            </div>
        </div>
        
        {% if aday %}
        <div class="bg-white dark:bg-card-dark rounded-lg border border-border-light dark:border-border-dark">
            <div class="px-5 py-4 border-b border-border-light dark:border-border-dark">
                <h3 class="font-semibold text-text-primary dark:text-text-primary-dark flex items-center gap-2">
                    <span class="material-symbols-outlined text-lg">history</span>
                    Aday Bilgileri
                </h3>
            </div>
            <ul class="divide-y divide-border-light dark:divide-border-dark">
                <li class="px-5 py-3 flex justify-between text-sm">
                    <span class="text-text-muted dark:text-text-muted-dark">Başvuru Tarihi</span>
                    <span class="text-text-primary dark:text-text-primary-dark">{{ aday.basvuru_tarihi.strftime('%d.%m.%Y') if aday.basvuru_tarihi else '-' }}</span>
                </li>
                <li class="px-5 py-3 flex justify-between text-sm">
                    <span class="text-text-muted dark:text-text-muted-dark">Durum</span>
                    {% set durum_renkler = {
                        'davet_gonderildi': 'gray',
                        'kvkk_bekliyor': 'yellow',
                        'basvurdu': 'blue',
                        'degerlendiriliyor': 'cyan',
                        'mulakat': 'indigo',
                        'teklif': 'yellow',
                        'ise_alindi': 'green',
                        'red': 'red',
                        'iptal': 'gray'
                    } %}
                    <span class="inline-flex px-2 py-0.5 text-xs font-medium rounded-full bg-{{ durum_renkler.get(aday.durum, 'gray') }}-100 text-{{ durum_renkler.get(aday.durum, 'gray') }}-700 dark:bg-{{ durum_renkler.get(aday.durum, 'gray') }}-900/30 dark:text-{{ durum_renkler.get(aday.durum, 'gray') }}-400">
                        {{ aday.durum|replace('_', ' ')|title }}
                    </span>
                </li>
                <li class="px-5 py-3 flex justify-between text-sm">
                    <span class="text-text-muted dark:text-text-muted-dark">KVKK Onayı</span>
                    {% if aday.kvkk_onay %}
                    <span class="text-green-600 flex items-center gap-1"><span class="material-symbols-outlined text-sm">check_circle</span> Onaylandı</span>
                    {% else %}
                    <span class="text-yellow-600 flex items-center gap-1"><span class="material-symbols-outlined text-sm">warning</span> Bekleniyor</span>
                    {% endif %}
                </li>
                {% if aday.kadro %}
                <li class="px-5 py-3 flex justify-between text-sm">
                    <span class="text-text-muted dark:text-text-muted-dark">Kadro</span>
                    <span class="text-text-primary dark:text-text-primary-dark">{{ aday.kadro.pozisyon_adi }}</span>
                </li>
                {% endif %}
            </ul>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
