{% extends "base.html" %}

{% block title %}{{ aday.ad }} {{ aday.soyad }} - Aday Detay - TG Portal{% endblock %}
{% block page_title %}Aday Detay{% endblock %}

{% block content %}
<!-- Breadcrumbs -->
<div class="flex items-center gap-2 text-sm text-text-muted dark:text-text-muted-dark mb-6">
    <a class="hover:text-primary transition-colors" href="{{ url_for('core.dashboard') }}">Ana Sayfa</a>
    <span class="material-symbols-outlined text-xs">chevron_right</span>
    <a class="hover:text-primary transition-colors" href="{{ url_for('ik.aday_liste') }}">Adaylar</a>
    <span class="material-symbols-outlined text-xs">chevron_right</span>
    <span class="text-[#111418] dark:text-white font-medium">{{ aday.ad }} {{ aday.soyad }}</span>
</div>

<!-- Main Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
    
    <!-- Left Column: Profile Overview -->
    <aside class="lg:col-span-4 space-y-6">
        
        <!-- Profile Card -->
        <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark overflow-hidden shadow-sm">
            <div class="p-6 flex flex-col items-center text-center">
                <div class="relative mb-4">
                    <div class="w-32 h-32 rounded-full border-4 border-gray-100 dark:border-gray-700 overflow-hidden bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                        {% if aday.fotograf %}
                        <img alt="{{ aday.ad }}" class="w-full h-full object-cover" src="{{ url_for('static', filename='uploads/' + aday.fotograf) }}"/>
                        {% else %}
                        <span class="text-4xl font-bold text-gray-400 dark:text-gray-500">{{ aday.ad[0] if aday.ad else '' }}{{ aday.soyad[0] if aday.soyad else '' }}</span>
                        {% endif %}
                    </div>
                    {% if aday.durum == 'ise_alindi' %}
                    <span class="absolute bottom-2 right-2 w-6 h-6 bg-green-500 border-4 border-white dark:border-card-dark rounded-full"></span>
                    {% endif %}
                </div>
                <h2 class="text-xl font-bold text-[#111418] dark:text-white">{{ aday.ad }} {{ aday.soyad }}</h2>
                <p class="text-text-muted dark:text-text-muted-dark font-medium">{{ aday.pozisyon.ad if aday.pozisyon else 'Pozisyon Belirtilmemiş' }}</p>
                <div class="mt-2 inline-flex items-center gap-1.5 px-3 py-1 bg-primary/10 text-primary rounded-full text-xs font-bold uppercase tracking-wider">
                    ID: #{{ aday.id }}
                </div>
            </div>
            
            <div class="px-6 pb-6 space-y-4">
                {% if aday.email %}
                <div class="flex items-center gap-3 text-sm">
                    <span class="material-symbols-outlined text-text-muted dark:text-text-muted-dark">mail</span>
                    <a href="mailto:{{ aday.email }}" class="hover:text-primary transition-colors">{{ aday.email }}</a>
                </div>
                {% endif %}
                {% if aday.telefon %}
                <div class="flex items-center gap-3 text-sm">
                    <span class="material-symbols-outlined text-text-muted dark:text-text-muted-dark">call</span>
                    <a href="tel:{{ aday.telefon }}" class="hover:text-primary transition-colors">{{ aday.telefon }}</a>
                </div>
                {% endif %}
                {% if aday.il %}
                <div class="flex items-center gap-3 text-sm">
                    <span class="material-symbols-outlined text-text-muted dark:text-text-muted-dark">location_on</span>
                    <span>{{ aday.ilce ~ ', ' if aday.ilce else '' }}{{ aday.il }}</span>
                </div>
                {% endif %}
                {% if aday.kaynak %}
                <div class="flex items-center gap-3 text-sm">
                    <span class="material-symbols-outlined text-text-muted dark:text-text-muted-dark">source</span>
                    <span>{{ aday.kaynak }}</span>
                </div>
                {% endif %}
            </div>
            
            <div class="border-t border-border-light dark:border-border-dark p-6 flex flex-col gap-3">
                {% if aday.durum != 'ise_alindi' and aday.durum != 'reddedildi' %}
                <a href="{{ url_for('ik.aday_calisana_donustur', id=aday.id) }}" class="w-full bg-primary hover:bg-primary-dark text-white font-bold py-2.5 rounded-lg transition-all flex items-center justify-center gap-2">
                    <span class="material-symbols-outlined text-lg">person_add</span>
                    Çalışana Dönüştür
                </a>
                {% endif %}
                <div class="grid grid-cols-2 gap-3">
                    <a href="{{ url_for('ik.aday_duzenle', id=aday.id) }}" class="bg-gray-100 dark:bg-[#111418] hover:bg-gray-200 dark:hover:bg-[#252b36] text-sm font-bold py-2 rounded-lg transition-all text-center">Düzenle</a>
                    {% if aday.durum != 'reddedildi' %}
                    <button onclick="document.getElementById('redModal').classList.remove('hidden')" class="bg-gray-100 dark:bg-[#111418] hover:bg-red-100 dark:hover:bg-red-900/20 text-sm font-bold py-2 rounded-lg transition-all text-red-600">Reddet</button>
                    {% else %}
                    <span class="bg-red-100 dark:bg-red-900/20 text-red-600 text-sm font-bold py-2 rounded-lg text-center">Reddedildi</span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Status Management -->
        <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark p-6 shadow-sm">
            <h3 class="text-xs font-bold uppercase text-text-muted dark:text-text-muted-dark mb-4 tracking-widest">Aday Durum Yönetimi</h3>
            <form action="{{ url_for('ik.aday_durum_degistir', id=aday.id) }}" method="POST" class="space-y-4">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div>
                    <label class="block text-xs font-semibold text-text-muted dark:text-text-muted-dark mb-1.5 uppercase">Güncel Aşama</label>
                    <select name="durum" class="w-full bg-gray-50 dark:bg-[#111418] border-border-light dark:border-border-dark rounded-lg text-sm focus:ring-primary focus:border-primary">
                        <option value="basvurdu" {% if aday.durum == 'basvurdu' %}selected{% endif %}>Başvurdu</option>
                        <option value="degerlendiriliyor" {% if aday.durum == 'degerlendiriliyor' %}selected{% endif %}>Değerlendiriliyor</option>
                        <option value="mulakat" {% if aday.durum == 'mulakat' %}selected{% endif %}>Mülakat</option>
                        <option value="teklif" {% if aday.durum == 'teklif' %}selected{% endif %}>Teklif Aşamasında</option>
                        <option value="ise_alindi" {% if aday.durum == 'ise_alindi' %}selected{% endif %}>İşe Alındı</option>
                        <option value="reddedildi" {% if aday.durum == 'reddedildi' %}selected{% endif %}>Reddedildi</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-primary/10 hover:bg-primary/20 text-primary font-bold py-2 rounded-lg transition-all text-sm">
                    Durumu Güncelle
                </button>
            </form>
        </div>
        
    </aside>
    
    <!-- Right Column: Details & Tabs -->
    <div class="lg:col-span-8 space-y-6">
        
        <!-- Recruitment Progress -->
        <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark p-6 shadow-sm">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold text-[#111418] dark:text-white">İşe Alım Süreci</h3>
                {% set progress = {'basvurdu': 20, 'degerlendiriliyor': 40, 'mulakat': 60, 'teklif': 80, 'ise_alindi': 100, 'reddedildi': 0} %}
                {% set current_progress = progress.get(aday.durum, 0) %}
                <span class="text-sm font-bold text-primary px-3 py-1 bg-primary/10 rounded-full">%{{ current_progress }} Tamamlandı</span>
            </div>
            <div class="relative py-4">
                <div class="h-1.5 w-full bg-gray-100 dark:bg-[#111418] rounded-full overflow-hidden">
                    <div class="h-full bg-primary transition-all duration-500" style="width: {{ current_progress }}%"></div>
                </div>
                <div class="flex justify-between mt-4">
                    <div class="flex flex-col items-center gap-1">
                        <div class="w-4 h-4 rounded-full {% if current_progress >= 20 %}bg-primary{% else %}bg-gray-200 dark:bg-gray-700{% endif %}"></div>
                        <span class="text-[10px] font-bold uppercase {% if current_progress >= 20 %}text-primary{% else %}text-text-muted dark:text-text-muted-dark{% endif %}">Başvuru</span>
                    </div>
                    <div class="flex flex-col items-center gap-1">
                        <div class="w-4 h-4 rounded-full {% if current_progress >= 40 %}bg-primary{% else %}bg-gray-200 dark:bg-gray-700{% endif %}"></div>
                        <span class="text-[10px] font-bold uppercase {% if current_progress >= 40 %}text-primary{% else %}text-text-muted dark:text-text-muted-dark{% endif %}">Değerlendirme</span>
                    </div>
                    <div class="flex flex-col items-center gap-1">
                        <div class="w-4 h-4 rounded-full {% if current_progress >= 60 %}bg-primary{% else %}bg-gray-200 dark:bg-gray-700{% endif %}"></div>
                        <span class="text-[10px] font-bold uppercase {% if current_progress >= 60 %}text-primary{% else %}text-text-muted dark:text-text-muted-dark{% endif %}">Mülakat</span>
                    </div>
                    <div class="flex flex-col items-center gap-1">
                        <div class="w-4 h-4 rounded-full {% if current_progress >= 80 %}bg-primary{% elif aday.durum == 'teklif' %}border-2 border-primary bg-white dark:bg-card-dark ring-4 ring-primary/20{% else %}bg-gray-200 dark:bg-gray-700{% endif %}"></div>
                        <span class="text-[10px] font-bold uppercase {% if current_progress >= 80 %}text-primary{% else %}text-text-muted dark:text-text-muted-dark{% endif %}">Teklif</span>
                    </div>
                    <div class="flex flex-col items-center gap-1">
                        <div class="w-4 h-4 rounded-full {% if current_progress >= 100 %}bg-green-500{% else %}bg-gray-200 dark:bg-gray-700{% endif %}"></div>
                        <span class="text-[10px] font-bold uppercase {% if current_progress >= 100 %}text-green-500{% else %}text-text-muted dark:text-text-muted-dark{% endif %}">İşe Alım</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Document Tracking Table -->
        <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark overflow-hidden shadow-sm">
            <div class="p-6 border-b border-border-light dark:border-border-dark flex items-center justify-between">
                <h3 class="text-lg font-bold text-[#111418] dark:text-white">Evrak Takibi</h3>
                <a href="{{ url_for('ik.aday_evrak_yukle', id=aday.id) }}" class="text-primary text-sm font-bold flex items-center gap-1 hover:underline">
                    <span class="material-symbols-outlined text-lg">add_circle</span>
                    Yeni Ekle
                </a>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 dark:bg-[#111418] text-xs font-bold text-text-muted dark:text-text-muted-dark uppercase">
                        <tr>
                            <th class="px-6 py-4">Belge Adı</th>
                            <th class="px-6 py-4 hidden sm:table-cell">Yükleme Tarihi</th>
                            <th class="px-6 py-4">Durum</th>
                            <th class="px-6 py-4 text-right">İşlemler</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-border-light dark:divide-border-dark">
                        {% for evrak in aday.evraklar or [] %}
                        <tr class="hover:bg-gray-50 dark:hover:bg-[#252b36] transition-colors">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <span class="material-symbols-outlined {% if evrak.durum == 'onaylandi' %}text-green-500{% elif evrak.durum == 'bekliyor' %}text-amber-500{% else %}text-gray-400{% endif %}">description</span>
                                    <span class="text-sm font-medium text-[#111418] dark:text-white">{{ evrak.evrak_tipi.ad if evrak.evrak_tipi else evrak.ad }}</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 text-sm text-text-muted dark:text-text-muted-dark hidden sm:table-cell">
                                {{ evrak.created_at.strftime('%d.%m.%Y') if evrak.created_at else '-' }}
                            </td>
                            <td class="px-6 py-4">
                                {% if evrak.durum == 'onaylandi' %}
                                <span class="px-2 py-1 bg-green-500/10 text-green-600 dark:text-green-400 text-[10px] font-bold rounded uppercase">Onaylandı</span>
                                {% elif evrak.durum == 'bekliyor' %}
                                <span class="px-2 py-1 bg-amber-500/10 text-amber-600 dark:text-amber-400 text-[10px] font-bold rounded uppercase">İnceleniyor</span>
                                {% elif evrak.durum == 'reddedildi' %}
                                <span class="px-2 py-1 bg-red-500/10 text-red-600 dark:text-red-400 text-[10px] font-bold rounded uppercase">Reddedildi</span>
                                {% else %}
                                <span class="px-2 py-1 bg-gray-500/10 text-gray-600 dark:text-gray-400 text-[10px] font-bold rounded uppercase">Eksik</span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 text-right">
                                <div class="flex items-center justify-end gap-2">
                                    {% if evrak.dosya_yolu %}
                                    <a href="{{ url_for('static', filename='uploads/' + evrak.dosya_yolu) }}" target="_blank" class="w-8 h-8 rounded bg-gray-100 dark:bg-[#111418] flex items-center justify-center hover:text-primary transition-colors">
                                        <span class="material-symbols-outlined text-lg">visibility</span>
                                    </a>
                                    <a href="{{ url_for('static', filename='uploads/' + evrak.dosya_yolu) }}" download class="w-8 h-8 rounded bg-gray-100 dark:bg-[#111418] flex items-center justify-center hover:text-primary transition-colors">
                                        <span class="material-symbols-outlined text-lg">download</span>
                                    </a>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="4" class="px-6 py-8 text-center text-text-muted dark:text-text-muted-dark">
                                <span class="material-symbols-outlined text-3xl mb-2 opacity-50">folder_off</span>
                                <p>Henüz evrak yüklenmemiş</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Personal Information Grid -->
        <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark p-6 shadow-sm">
            <h3 class="text-lg font-bold text-[#111418] dark:text-white mb-6">Kişisel Bilgiler</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6">
                {% if aday.tc_kimlik %}
                <div class="flex flex-col gap-1">
                    <span class="text-xs font-bold text-text-muted dark:text-text-muted-dark uppercase">T.C. Kimlik No</span>
                    <span class="text-sm font-medium text-[#111418] dark:text-white">{{ aday.tc_kimlik }}</span>
                </div>
                {% endif %}
                {% if aday.dogum_tarihi %}
                <div class="flex flex-col gap-1">
                    <span class="text-xs font-bold text-text-muted dark:text-text-muted-dark uppercase">Doğum Tarihi</span>
                    <span class="text-sm font-medium text-[#111418] dark:text-white">{{ aday.dogum_tarihi.strftime('%d.%m.%Y') }}</span>
                </div>
                {% endif %}
                {% if aday.egitim_durumu %}
                <div class="flex flex-col gap-1">
                    <span class="text-xs font-bold text-text-muted dark:text-text-muted-dark uppercase">Eğitim Durumu</span>
                    <span class="text-sm font-medium text-[#111418] dark:text-white">{{ aday.egitim_durumu }}</span>
                </div>
                {% endif %}
                {% if aday.universite %}
                <div class="flex flex-col gap-1">
                    <span class="text-xs font-bold text-text-muted dark:text-text-muted-dark uppercase">Üniversite</span>
                    <span class="text-sm font-medium text-[#111418] dark:text-white">{{ aday.universite }}</span>
                </div>
                {% endif %}
                {% if aday.maas_beklentisi %}
                <div class="flex flex-col gap-1">
                    <span class="text-xs font-bold text-text-muted dark:text-text-muted-dark uppercase">Maaş Beklentisi</span>
                    <span class="text-sm font-medium text-[#111418] dark:text-white">{{ '{:,.0f}'.format(aday.maas_beklentisi).replace(',', '.') }} ₺</span>
                </div>
                {% endif %}
                {% if aday.ehliyet %}
                <div class="flex flex-col gap-1">
                    <span class="text-xs font-bold text-text-muted dark:text-text-muted-dark uppercase">Sürücü Belgesi</span>
                    <span class="text-sm font-medium text-[#111418] dark:text-white">{{ aday.ehliyet }}</span>
                </div>
                {% endif %}
                {% if aday.askerlik_durumu %}
                <div class="flex flex-col gap-1">
                    <span class="text-xs font-bold text-text-muted dark:text-text-muted-dark uppercase">Askerlik Durumu</span>
                    <span class="text-sm font-medium text-[#111418] dark:text-white">{{ aday.askerlik_durumu }}</span>
                </div>
                {% endif %}
                <div class="flex flex-col gap-1">
                    <span class="text-xs font-bold text-text-muted dark:text-text-muted-dark uppercase">Başvuru Tarihi</span>
                    <span class="text-sm font-medium text-[#111418] dark:text-white">{{ aday.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                </div>
            </div>
            {% if aday.notlar_text %}
            <div class="mt-6 pt-6 border-t border-border-light dark:border-border-dark">
                <span class="text-xs font-bold text-text-muted dark:text-text-muted-dark uppercase">Ek Notlar</span>
                <p class="text-sm text-[#111418] dark:text-white mt-2 whitespace-pre-line">{{ aday.notlar_text }}</p>
            </div>
            {% endif %}
        </div>
        
        <!-- Evaluation Notes -->
        <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark p-6 shadow-sm">
            <h3 class="text-lg font-bold text-[#111418] dark:text-white mb-6">Değerlendirme Notları</h3>
            <div class="space-y-6">
                {% for note in aday.notlar or [] %}
                <div class="flex gap-4">
                    <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-[#111418] flex-shrink-0 flex items-center justify-center font-bold text-primary text-sm">
                        {{ note.kullanici.ad[0] if note.kullanici and note.kullanici.ad else 'U' }}{{ note.kullanici.soyad[0] if note.kullanici and note.kullanici.soyad else '' }}
                    </div>
                    <div class="flex-1 bg-gray-50 dark:bg-[#111418] rounded-xl p-4 border border-border-light dark:border-border-dark">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-bold text-[#111418] dark:text-white">{{ note.kullanici.full_name if note.kullanici else 'Bilinmeyen' }}</span>
                            <span class="text-[10px] text-text-muted dark:text-text-muted-dark font-medium">{{ note.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                        </div>
                        <p class="text-sm text-text-muted dark:text-text-muted-dark">{{ note.icerik }}</p>
                    </div>
                </div>
                {% else %}
                <div class="text-center text-text-muted dark:text-text-muted-dark py-4">
                    <span class="material-symbols-outlined text-3xl mb-2 opacity-50">speaker_notes_off</span>
                    <p>Henüz değerlendirme notu eklenmemiş</p>
                </div>
                {% endfor %}
                
                <!-- Add New Note Form -->
                <form action="#" method="POST" style="display:none;" class="pt-4 border-t border-border-light dark:border-border-dark">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <textarea name="icerik" class="w-full bg-gray-50 dark:bg-[#111418] border-border-light dark:border-border-dark rounded-xl p-4 text-sm focus:ring-primary focus:border-primary min-h-[100px] text-[#111418] dark:text-white placeholder-text-muted dark:placeholder-text-muted-dark" placeholder="Yeni bir not ekle..."></textarea>
                    <div class="flex justify-end mt-3">
                        <button type="submit" class="bg-primary hover:bg-primary-dark text-white font-bold px-6 py-2 rounded-lg text-sm transition-all">
                            Gönder
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
    </div>
</div>

<!-- Red Modal -->
<div id="redModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white dark:bg-card-dark rounded-xl shadow-xl max-w-md w-full p-6">
        <h3 class="text-lg font-bold text-[#111418] dark:text-white mb-4">Adayı Reddet</h3>
        <form action="#" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <textarea name="red_sebebi" class="w-full bg-gray-50 dark:bg-[#111418] border-border-light dark:border-border-dark rounded-lg p-3 text-sm min-h-[100px]" placeholder="Red sebebini yazın..." required></textarea>
            <div class="flex justify-end gap-3 mt-4">
                <button type="button" onclick="document.getElementById('redModal').classList.add('hidden')" class="px-4 py-2 bg-gray-100 dark:bg-[#111418] rounded-lg font-medium text-sm hover:bg-gray-200 dark:hover:bg-[#252b36] transition-colors">
                    İptal
                </button>
                <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-lg font-bold text-sm hover:bg-red-700 transition-colors">
                    Reddet
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}