{% extends "base.html" %}

{% block title %}İkame Araç Detay - {{ ikame.plaka }} - TG Portal{% endblock %}
{% block page_title %}İkame Araç Detayı{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2">
        <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm mb-6">
            <div class="bg-cyan-500 text-white px-4 py-3 rounded-t-xl flex justify-between items-center">
                <h6 class="font-medium flex items-center gap-2">
                    <span class="material-symbols-outlined">sync</span>
                    {{ ikame.plaka }} - {{ ikame.marka or '' }} {{ ikame.model or '' }}
                </h6>
                <span class="px-2 py-1 text-xs font-medium rounded-full {% if ikame.durum == 'aktif' %}bg-green-500{% else %}bg-gray-500{% endif %}">
                    {{ ikame.durum|upper }}
                </span>
            </div>
            <div class="p-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <table class="w-full text-sm">
                        <tr>
                            <td class="text-text-muted dark:text-text-muted-dark py-1 w-28">Asıl Araç</td>
                            <td class="py-1">
                                <a href="{{ url_for('filo.detay', id=ikame.asil_arac_id) }}" class="text-blue-600 hover:underline">
                                    {{ ikame.asil_arac.plaka }}
                                </a>
                            </td>
                        </tr>
                        <tr>
                            <td class="text-text-muted dark:text-text-muted-dark py-1">Neden</td>
                            <td class="py-1"><span class="px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-700 dark:text-blue-300/80 dark:bg-blue-900/30 dark:text-blue-400">{{ ikame.neden|upper }}</span></td>
                        </tr>
                        <tr>
                            <td class="text-text-muted dark:text-text-muted-dark py-1">Tedarikçi</td>
                            <td class="py-1">{{ ikame.tedarikci.ad if ikame.tedarikci else '-' }}</td>
                        </tr>
                        <tr>
                            <td class="text-text-muted dark:text-text-muted-dark py-1">Günlük Ücret</td>
                            <td class="py-1">{{ "%.2f"|format(ikame.gunluk_ucret) if ikame.gunluk_ucret else '-' }} ₺</td>
                        </tr>
                    </table>
                    <table class="w-full text-sm">
                        <tr>
                            <td class="text-text-muted dark:text-text-muted-dark py-1 w-28">Başlangıç</td>
                            <td class="py-1">{{ ikame.baslangic_tarihi.strftime('%d.%m.%Y') }}</td>
                        </tr>
                        <tr>
                            <td class="text-text-muted dark:text-text-muted-dark py-1">Bitiş</td>
                            <td class="py-1">{{ ikame.bitis_tarihi.strftime('%d.%m.%Y') if ikame.bitis_tarihi else 'Devam Ediyor' }}</td>
                        </tr>
                        <tr>
                            <td class="text-text-muted dark:text-text-muted-dark py-1">Başlangıç KM</td>
                            <td class="py-1">{{ ikame.baslangic_km or '-' }}</td>
                        </tr>
                        <tr>
                            <td class="text-text-muted dark:text-text-muted-dark py-1">Bitiş KM</td>
                            <td class="py-1">{{ ikame.bitis_km or '-' }}</td>
                        </tr>
                    </table>
                </div>
                
                <hr class="my-4 border-border-light dark:border-border-dark">
                
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold text-[#111418] dark:text-white">{{ ikame.aktif_gun_sayisi }}</div>
                        <div class="text-sm text-text-muted dark:text-text-muted-dark">Gün</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-[#111418] dark:text-white">{{ "%.2f"|format(ikame.toplam_maliyet) }} ₺</div>
                        <div class="text-sm text-text-muted dark:text-text-muted-dark">Toplam Maliyet</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-[#111418] dark:text-white">{{ (ikame.bitis_km - ikame.baslangic_km) if ikame.bitis_km and ikame.baslangic_km else '-' }}</div>
                        <div class="text-sm text-text-muted dark:text-text-muted-dark">Kullanılan KM</div>
                    </div>
                </div>
                
                {% if ikame.ilgili_kaza %}
                <hr class="my-4 border-border-light dark:border-border-dark">
                <h6 class="font-medium text-[#111418] dark:text-white flex items-center gap-2 mb-2">
                    <span class="material-symbols-outlined">warning</span>İlgili Kaza
                </h6>
                <a href="{{ url_for('filo.kaza_detay', id=ikame.ilgili_kaza_id) }}" class="text-blue-600 hover:underline">
                    {{ ikame.ilgili_kaza.tarih.strftime('%d.%m.%Y') }} - {{ ikame.ilgili_kaza.konum or 'Detay için tıklayın' }}
                </a>
                {% endif %}
                
                {% if ikame.notlar %}
                <hr class="my-4 border-border-light dark:border-border-dark">
                <h6 class="font-medium text-[#111418] dark:text-white flex items-center gap-2 mb-2">
                    <span class="material-symbols-outlined">sticky_note_2</span>Notlar
                </h6>
                <p class="text-text-muted dark:text-text-muted-dark">{{ ikame.notlar }}</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div>
        {% if ikame.durum == 'aktif' %}
        <div class="bg-white dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm">
            <div class="px-4 py-3 border-b border-border-light dark:border-border-dark">
                <h6 class="font-medium text-[#111418] dark:text-white flex items-center gap-2">
                    <span class="material-symbols-outlined">login</span>İade Et
                </h6>
            </div>
            <div class="p-4">
                <form method="POST" action="{{ url_for('filo.ikame_iade', id=ikame.id) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-[#111418] dark:text-white mb-1">Bitiş Tarihi *</label>
                        <input type="date" name="bitis_tarihi" class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required value="{{ today().strftime('%Y-%m-%d') if today else '' }}">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[#111418] dark:text-white mb-1">Bitiş KM</label>
                        <input type="number" name="bitis_km" class="w-full px-3 py-2 border border-border-light dark:border-border-dark dark:bg-[#111418] rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <button type="submit" class="w-full inline-flex items-center justify-center gap-2 px-4 py-2 bg-yellow-500 text-white font-medium rounded-lg hover:bg-yellow-600 transition-colors">
                        <span class="material-symbols-outlined">check</span>İade Et
                    </button>
                </form>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<div class="mt-4">
    <a href="{{ url_for('filo.ikame_liste') }}" class="inline-flex items-center gap-2 px-4 py-2 border border-gray-300 text-[#111418] dark:text-white font-medium rounded-lg hover:bg-gray-50 dark:hover:bg-[#252b36] transition-colors">
        <span class="material-symbols-outlined">arrow_back</span>Listeye Dön
    </a>
</div>
{% endblock %}
