{% extends "base.html" %}

{% block title %}{{ 'Araç Düzenle' if arac else 'Yeni Araç' }} - TG Portal{% endblock %}
{% block page_title %}{{ 'Araç Düzenle' if arac else 'Yeni Araç Ekle' }}{% endblock %}

{% block content %}
<form method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <div class="row">
        <div class="col-lg-8">
            <!-- Temel Bilgiler -->
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h6 class="mb-0"><i class="bi bi-truck me-2"></i>Temel Bilgiler</h6>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Plaka <span class="text-danger">*</span></label>
                            <input type="text" name="plaka" class="form-control text-uppercase" required
                                   value="{{ arac.plaka if arac else '' }}" placeholder="34 ABC 123">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Marka <span class="text-danger">*</span></label>
                            <input type="text" name="marka" class="form-control" required
                                   value="{{ arac.marka if arac else '' }}" placeholder="Ford">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Model</label>
                            <input type="text" name="model" class="form-control"
                                   value="{{ arac.model if arac else '' }}" placeholder="Transit">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Model Yılı</label>
                            <input type="number" name="model_yili" class="form-control"
                                   value="{{ arac.model_yili if arac else '' }}" min="1990" max="2030">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Renk</label>
                            <input type="text" name="renk" class="form-control"
                                   value="{{ arac.renk if arac else '' }}">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Kilometre</label>
                            <input type="number" name="km" class="form-control"
                                   value="{{ arac.km if arac else '0' }}">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Durum</label>
                            <select name="durum" class="form-select">
                                {% for d in durumlar %}
                                <option value="{{ d.value }}" {% if arac and arac.durum == d %}selected{% endif %}>
                                    {{ d.value|replace('_', ' ')|title }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Teknik Bilgiler -->
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h6 class="mb-0"><i class="bi bi-gear me-2"></i>Teknik Bilgiler</h6>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Şasi No</label>
                            <input type="text" name="sasi_no" class="form-control"
                                   value="{{ arac.sasi_no if arac else '' }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Motor No</label>
                            <input type="text" name="motor_no" class="form-control"
                                   value="{{ arac.motor_no if arac else '' }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Yakıt Tipi</label>
                            <select name="yakit_tipi" class="form-select">
                                <option value="">Seçiniz</option>
                                {% for y in yakit_tipleri %}
                                <option value="{{ y.value }}" {% if arac and arac.yakit_tipi == y %}selected{% endif %}>
                                    {{ y.value|title }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Motor Hacmi (cc)</label>
                            <input type="number" name="motor_hacmi" class="form-control"
                                   value="{{ arac.motor_hacmi if arac else '' }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Vites Tipi</label>
                            <select name="vites_tipi" class="form-select">
                                <option value="">Seçiniz</option>
                                <option value="manuel" {% if arac and arac.vites_tipi == 'manuel' %}selected{% endif %}>Manuel</option>
                                <option value="otomatik" {% if arac and arac.vites_tipi == 'otomatik' %}selected{% endif %}>Otomatik</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sahiplik Bilgileri -->
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h6 class="mb-0"><i class="bi bi-file-earmark-text me-2"></i>Sahiplik Bilgileri</h6>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Sahiplik Tipi</label>
                            <select name="sahiplik_tipi" class="form-select">
                                <option value="">Seçiniz</option>
                                <option value="sirket" {% if arac and arac.sahiplik_tipi == 'sirket' %}selected{% endif %}>Şirket</option>
                                <option value="kiralama" {% if arac and arac.sahiplik_tipi == 'kiralama' %}selected{% endif %}>Kiralama</option>
                                <option value="leasing" {% if arac and arac.sahiplik_tipi == 'leasing' %}selected{% endif %}>Leasing</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Kira Başlangıç</label>
                            <input type="date" name="kira_baslangic" class="form-control"
                                   value="{{ arac.kira_baslangic.strftime('%Y-%m-%d') if arac and arac.kira_baslangic else '' }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Kira Bitiş</label>
                            <input type="date" name="kira_bitis" class="form-control"
                                   value="{{ arac.kira_bitis.strftime('%Y-%m-%d') if arac and arac.kira_bitis else '' }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Aylık Kira (₺)</label>
                            <input type="number" name="aylik_kira" class="form-control" step="0.01"
                                   value="{{ arac.aylik_kira if arac else '' }}">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Notlar -->
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h6 class="mb-0"><i class="bi bi-sticky me-2"></i>Notlar</h6>
                </div>
                <div class="card-body">
                    <textarea name="notlar" class="form-control" rows="3">{{ arac.notlar if arac else '' }}</textarea>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <!-- Atama -->
            <div class="card mb-4">
                <div class="card-header bg-white">
                    <h6 class="mb-0"><i class="bi bi-person-check me-2"></i>Atama</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Proje</label>
                        <select name="proje_id" class="form-select select2">
                            <option value="">Proje Seçiniz</option>
                            {% for p in projeler %}
                            <option value="{{ p.id }}" {% if arac and arac.proje_id == p.id %}selected{% endif %}>
                                {{ p.ad }} ({{ p.musteri.display_name }})
                            </option>
                            {% endfor %}
                        </select>
                        <small class="text-muted">Araç hangi projeye tahsis edilecek?</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Şoför / Kullanıcı</label>
                        <select name="atanan_calisan_id" class="form-select select2">
                            <option value="">Şoför Seçiniz</option>
                            {% for c in calisanlar %}
                            <option value="{{ c.id }}" {% if arac and arac.atanan_calisan_id == c.id %}selected{% endif %}>
                                {{ c.full_name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Aksiyonlar -->
            <div class="card">
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-lg me-1"></i>{{ 'Güncelle' if arac else 'Kaydet' }}
                        </button>
                        <a href="{{ url_for('filo.detay', id=arac.id) if arac else url_for('filo.liste') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-lg me-1"></i>İptal
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}
