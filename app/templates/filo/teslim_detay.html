{% extends "base.html" %}

{% block title %}Teslim/İade Detay - {{ teslim.arac.plaka }} - TG Portal{% endblock %}
{% block page_title %}{{ 'Araç Teslim' if teslim.islem_tipi == 'teslim' else 'Araç İade' }} Detayı{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header bg-{{ 'success' if teslim.islem_tipi == 'teslim' else 'warning' }} text-white d-flex justify-content-between">
                <h6 class="mb-0">
                    <i class="bi bi-{{ 'box-arrow-right' if teslim.islem_tipi == 'teslim' else 'box-arrow-in-left' }} me-2"></i>
                    {{ teslim.arac.plaka }} - {{ teslim.arac.marka }} {{ teslim.arac.model }}
                </h6>
                <a href="{{ url_for('filo.teslim_pdf', id=teslim.id) }}" class="btn btn-sm btn-light" target="_blank">
                    <i class="bi bi-printer me-1"></i>Yazdır
                </a>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <table class="table table-sm table-borderless">
                            <tr><td class="text-muted">İşlem Tipi</td><td><span class="badge bg-{{ 'success' if teslim.islem_tipi == 'teslim' else 'warning' }}">{{ teslim.islem_tipi|upper }}</span></td></tr>
                            <tr><td class="text-muted">Tarih</td><td>{{ teslim.tarih.strftime('%d.%m.%Y %H:%M') }}</td></tr>
                            <tr><td class="text-muted">Kilometre</td><td><strong>{{ teslim.km }} km</strong></td></tr>
                            <tr><td class="text-muted">Yakıt</td><td>{{ teslim.yakit_durumu_display }}</td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-sm table-borderless">
                            <tr><td class="text-muted">Teslim Eden</td><td>{{ teslim.teslim_eden_calisan.full_name if teslim.teslim_eden_calisan else (teslim.teslim_eden.full_name if teslim.teslim_eden else '-') }}</td></tr>
                            <tr><td class="text-muted">Teslim Alan</td><td>{{ teslim.teslim_alan_calisan.full_name if teslim.teslim_alan_calisan else (teslim.teslim_alan.full_name if teslim.teslim_alan else '-') }}</td></tr>
                        </table>
                    </div>
                </div>
                
                <h6><i class="bi bi-box-seam me-2"></i>Aksesuarlar</h6>
                <div class="mb-4">
                    {% for key in teslim.aksesuarlar or [] %}
                    <span class="badge bg-primary me-1">{{ aksesuarlar.get(key, key) }}</span>
                    {% else %}
                    <span class="text-muted">Belirtilmemiş</span>
                    {% endfor %}
                </div>
                
                {% if teslim.mevcut_hasarlar %}
                <h6><i class="bi bi-exclamation-triangle me-2"></i>Mevcut Hasarlar</h6>
                <p>{{ teslim.mevcut_hasarlar }}</p>
                {% endif %}
                
                {% if teslim.yeni_hasar %}
                <div class="alert alert-danger">
                    <h6><i class="bi bi-exclamation-circle me-2"></i>Yeni Hasar Tespit Edildi!</h6>
                    <p class="mb-0">{{ teslim.yeni_hasar_aciklama }}</p>
                </div>
                {% endif %}
                
                {% if teslim.notlar %}
                <h6><i class="bi bi-sticky me-2"></i>Notlar</h6>
                <p>{{ teslim.notlar }}</p>
                {% endif %}
            </div>
        </div>
        
        {% if teslim.fotograflar %}
        <div class="card mb-4">
            <div class="card-header"><h6 class="mb-0"><i class="bi bi-camera me-2"></i>Fotoğraflar</h6></div>
            <div class="card-body">
                <div class="row g-2">
                    {% for foto in teslim.fotograflar %}
                    <div class="col-md-3">
                        <img src="{{ url_for('static', filename='uploads/' + foto) }}" class="img-fluid rounded" alt="Fotoğraf">
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="col-lg-4">
        {% if teslim.imza_teslim_eden or teslim.imza_teslim_alan %}
        <div class="card">
            <div class="card-header"><h6 class="mb-0"><i class="bi bi-pen me-2"></i>İmzalar</h6></div>
            <div class="card-body">
                {% if teslim.imza_teslim_eden %}
                <p class="mb-1"><small class="text-muted">Teslim Eden:</small></p>
                <img src="{{ teslim.imza_teslim_eden }}" class="img-fluid border rounded mb-3" style="max-height:100px">
                {% endif %}
                {% if teslim.imza_teslim_alan %}
                <p class="mb-1"><small class="text-muted">Teslim Alan:</small></p>
                <img src="{{ teslim.imza_teslim_alan }}" class="img-fluid border rounded" style="max-height:100px">
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<div class="mt-3">
    <a href="{{ url_for('filo.teslim_liste') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>Listeye Dön
    </a>
</div>
{% endblock %}
