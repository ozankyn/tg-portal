{% extends "base.html" %}

{% block title %}İkame Araçlar - TG Portal{% endblock %}
{% block page_title %}İkame Araçlar{% endblock %}

{% block content %}
{% if aktif_sayisi > 0 %}
<div class="alert alert-info">
    <i class="bi bi-arrow-repeat me-2"></i>
    <strong>{{ aktif_sayisi }}</strong> aktif ikame araç bulunuyor.
</div>
{% endif %}

<div class="card">
    <div class="card-header">
        <form method="GET" class="row g-2">
            <div class="col-auto">
                <select name="durum" class="form-select form-select-sm" onchange="this.form.submit()">
                    <option value="">Tüm Durumlar</option>
                    <option value="aktif" {{ 'selected' if request.args.get('durum') == 'aktif' }}>Aktif</option>
                    <option value="iade_edildi" {{ 'selected' if request.args.get('durum') == 'iade_edildi' }}>İade Edildi</option>
                </select>
            </div>
        </form>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>İkame Plaka</th>
                        <th>Asıl Araç</th>
                        <th>Neden</th>
                        <th>Başlangıç</th>
                        <th>Bitiş</th>
                        <th>Gün</th>
                        <th>Maliyet</th>
                        <th>Durum</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for ikame in ikameler %}
                    <tr>
                        <td>
                            <strong>{{ ikame.plaka }}</strong>
                            <small class="text-muted d-block">{{ ikame.marka or '' }} {{ ikame.model or '' }}</small>
                        </td>
                        <td>
                            <a href="{{ url_for('filo.detay', id=ikame.asil_arac_id) }}">
                                {{ ikame.asil_arac.plaka }}
                            </a>
                        </td>
                        <td><span class="badge bg-primary">{{ ikame.neden }}</span></td>
                        <td>{{ ikame.baslangic_tarihi.strftime('%d.%m.%Y') }}</td>
                        <td>{{ ikame.bitis_tarihi.strftime('%d.%m.%Y') if ikame.bitis_tarihi else '-' }}</td>
                        <td>{{ ikame.aktif_gun_sayisi }}</td>
                        <td>{{ "%.0f"|format(ikame.toplam_maliyet) }} ₺</td>
                        <td>
                            <span class="badge bg-{{ 'success' if ikame.durum == 'aktif' else 'secondary' }}">
                                {{ ikame.durum }}
                            </span>
                        </td>
                        <td>
                            <a href="{{ url_for('filo.ikame_detay', id=ikame.id) }}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-eye"></i>
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="9" class="text-center text-muted py-4">İkame araç kaydı bulunamadı</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% if pagination.pages > 1 %}
<nav class="mt-3">
    <ul class="pagination pagination-sm justify-content-center">
        {% for p in pagination.iter_pages() %}
        {% if p %}
        <li class="page-item {{ 'active' if p == pagination.page }}">
            <a class="page-link" href="{{ url_for('filo.ikame_liste', page=p, **request.args) }}">{{ p }}</a>
        </li>
        {% endif %}
        {% endfor %}
    </ul>
</nav>
{% endif %}
{% endblock %}
